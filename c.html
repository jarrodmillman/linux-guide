<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Interacting with the operating system from R &mdash; RCSDS 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="RCSDS 0.1 documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>&#64;path/home/jarrod/src/stat243-fall-2014/units//</p>
<p>This will cover some of the more advanced features of R. However, since
many of them were covered in the R bootcamp, I skip through some
material quickly, assuming you have a working familiarity with the first
6 or so units from the bootcamp and/or from the R practice
sessions/problems with Jarrod. The material we’ll cover in full detail
will be Sections 7-8.</p>
<p>References:</p>
<ul class="simple">
<li>Adler</li>
<li>Chambers</li>
<li><a class="reference external" href="http://cran.r-project.org/doc/manuals/R-intro.html">R intro
manual</a> on
CRAN (R-intro).</li>
<li>Venables and Ripley, Modern Applied Statistics with S</li>
<li>Murrell, Introduction to Data Technologies.</li>
</ul>
<p>I’m going to try to refer to R syntax as <em>statements</em>, where a statement
is any code that is a valid, complete R expression. I’ll try not to use
the term <em>expression</em>, as this actually means a specific type of object
within the R language.</p>
<p>One of my goals in our coverage of R is for us to think about why things
are the way they are in R. I.e., what principles were used in creating
the language? Also, while other languages use different principles,
understanding what R does in detail will be helpful when you are
learning another language.</p>
<div class="section" id="interacting-with-the-operating-system-from-r">
<h1>Interacting with the operating system from R<a class="headerlink" href="#interacting-with-the-operating-system-from-r" title="Permalink to this headline">¶</a></h1>
<p>I’ll assume everyone knows about the following functions/functionality
in R:</p>
<p><em>getwd(), setwd(), source(), pdf(), save(), save.image(), load()</em></p>
<ul>
<li><p class="first">To run UNIX commands from within R, use <em>system()</em>, as follows,
noting that we can save the result of a system call to an R object:</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;badCode.R&quot;          &quot;bash.rst&quot;</span>
<span class="c">## [3] &quot;best-practices.png&quot; &quot;branchcommit.png&quot;</span>
<span class="c">## [5] &quot;cache&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">There are also a bunch of functions that will do specific queries of
the filesystem, including</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1] &quot;capeCod.zip&quot;    &quot;coop.txt&quot;       &quot;cpds.csv&quot;</span>
<span class="c">##  [4] &quot;hivSequ.csv&quot;    &quot;IPs.RData&quot;      &quot;prec.RData&quot;</span>
<span class="c">##  [7] &quot;precip.txt&quot;     &quot;precipData.txt&quot; &quot;RTADataSub.csv&quot;</span>
<span class="c">## [10] &quot;urls.txt&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">There are some tools for dealing with differences between operating
systems. Here’s an example:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1] &quot;capeCod.zip&quot;    &quot;coop.txt&quot;       &quot;cpds.csv&quot;</span>
<span class="c">##  [4] &quot;hivSequ.csv&quot;    &quot;IPs.RData&quot;      &quot;prec.RData&quot;</span>
<span class="c">##  [7] &quot;precip.txt&quot;     &quot;precipData.txt&quot; &quot;RTADataSub.csv&quot;</span>
<span class="c">## [10] &quot;urls.txt&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">To get some info on the system you’re running on:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##                              sysname</span>
<span class="c">##                              &quot;Linux&quot;</span>
<span class="c">##                              release</span>
<span class="c">##              &quot;4.1.4-200.fc22.x86_64&quot;</span>
<span class="c">##                              version</span>
<span class="c">## &quot;#1 SMP Tue Aug 4 03:22:33 UTC 2015&quot;</span>
<span class="c">##                             nodename</span>
<span class="c">##                              &quot;t430u&quot;</span>
<span class="c">##                              machine</span>
<span class="c">##                             &quot;x86_64&quot;</span>
<span class="c">##                                login</span>
<span class="c">##                             &quot;jarrod&quot;</span>
<span class="c">##                                 user</span>
<span class="c">##                             &quot;jarrod&quot;</span>
<span class="c">##                       effective_user</span>
<span class="c">##                             &quot;jarrod&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">To see some of the options that control how R behaves, try the
<em>options()</em> function. The <em>width</em> option changes the number of
characters of width printed to the screen, while the <em>max.print</em>
option prevents too much of a large object from being printed to the
screen. The <em>digits</em> option changes the number of digits of numbers
printed to the screen (but be careful as this can be deceptive if you
then try to compare two numbers based on what you see on the screen).</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $add.smooth</span>
<span class="c">## [1] TRUE</span>
<span class="c">##</span>
<span class="c">## $bitmapType</span>
<span class="c">## [1] &quot;cairo&quot;</span>
<span class="c">##</span>
<span class="c">## $browser</span>
<span class="c">## [1] &quot;/usr/bin/xdg-open&quot;</span>
<span class="c">##</span>
<span class="c">## $browserNLdisabled</span>
<span class="c">## [1] FALSE</span>
<span class="c">##</span>
<span class="c">## $CBoundsCheck</span>
<span class="c">## [1] FALSE</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $width</span>
<span class="c">## [1] 55</span>
<span class="c">##</span>
<span class="c">## $digits</span>
<span class="c">## [1] 7</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 0.123</span>
<span class="c">## [1] 0.123</span>
<span class="c">## [1] FALSE</span>
</pre></div>
</div>
</li>
<li><p class="first">Use <code class="docutils literal"><span class="pre">Ctrl-C</span></code> to interrupt execution. This will generally back out
gracefully, returning you to a state as if the command had not been
started. Note that if R is exceeding memory availability, there can
be a long delay. This can be frustrating, particularly since a
primary reason you would want to interrupt is when R runs out of
memory.</p>
</li>
<li><p class="first">The <a class="reference external" href="http://tolstoy.newcastle.edu.au/R/">R mailing list archives</a>
are very helpful for getting help - always search the archive before
posting a question. More info on where to find R help in Unit 5 on
debugging.</p>
<ul>
<li><p class="first"><em>sessionInfo()</em> gives information on the current R session - it’s
a good idea to include this information (and information on the
operating system such as from <em>Sys.info()</em>) when you ask for help
on a mailing list</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## R version 3.2.1 (2015-06-18)</span>
<span class="c">## Platform: x86_64-redhat-linux-gnu (64-bit)</span>
<span class="c">## Running under: Fedora 22 (Twenty Two)</span>
<span class="c">##</span>
<span class="c">## locale:</span>
<span class="c">##  [1] LC_CTYPE=en_US.UTF-8</span>
<span class="c">##  [2] LC_NUMERIC=C</span>
<span class="c">##  [3] LC_TIME=en_US.UTF-8</span>
<span class="c">##  [4] LC_COLLATE=en_US.UTF-8</span>
<span class="c">##  [5] LC_MONETARY=en_US.UTF-8</span>
<span class="c">##  [6] LC_MESSAGES=en_US.UTF-8</span>
<span class="c">##  [7] LC_PAPER=en_US.UTF-8</span>
<span class="c">##  [8] LC_NAME=C</span>
<span class="c">##  [9] LC_ADDRESS=C</span>
<span class="c">## [10] LC_TELEPHONE=C</span>
<span class="c">## [11] LC_MEASUREMENT=en_US.UTF-8</span>
<span class="c">## [12] LC_IDENTIFICATION=C</span>
<span class="c">##</span>
<span class="c">## attached base packages:</span>
<span class="c">## [1] stats     graphics  grDevices utils     datasets</span>
<span class="c">## [6] base</span>
<span class="c">##</span>
<span class="c">## other attached packages:</span>
<span class="c">## [1] knitr_1.10.5</span>
<span class="c">##</span>
<span class="c">## loaded via a namespace (and not attached):</span>
<span class="c">## [1] magrittr_1.5     formatR_1.2      tools_3.2.1</span>
<span class="c">## [4] codetools_0.2-11 stringi_0.5-5    highr_0.5</span>
<span class="c">## [7] digest_0.6.8     stringr_1.0.0    evaluate_0.7</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Any code that you wanted executed automatically when starting R can
be placed in <em>~/.Rprofile</em> (or in individual <em>.Rprofile</em> files in
specific directories). This could include loading packages (see
below), sourcing files that contain user-defined functions that you
commonly use (you can also put the function code itself in
<em>.Rprofile</em>), assigning variables, and specifying options via
<em>options()</em>.</p>
</li>
<li><p class="first">You can have an R script act as a shell script (like running a bash
shell script) as follows.</p>
<ol class="arabic simple">
<li>Write your R code in a text file, say <em>exampleRscript.R</em>.</li>
<li>As the first line of the file, include <code class="docutils literal"><span class="pre">#!/usr/bin/Rscript</span></code>
(like <code class="docutils literal"><span class="pre">#!/bin/bash</span></code> in a bash shell file, as seen in Unit 2).</li>
<li>Make the R code file executable with <em>chmod</em>:
<code class="docutils literal"><span class="pre">chmod</span> <span class="pre">ugo+x</span> <span class="pre">exampleRscript.R</span></code>.</li>
<li>Run the script from the command line: <code class="docutils literal"><span class="pre">./exampleRscript.R</span></code></li>
</ol>
<p>If you want to pass arguments into your script, you can do so as long
as you set up the R code to interpret the incoming arguments:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">args&nbsp;&lt;-&nbsp;(TRUE)</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">charArg&nbsp;&lt;-&nbsp;args[2]logicalArg&nbsp;&lt;-&nbsp;(args[3]</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">(,&nbsp;numericArg,&nbsp;,&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;charArg,&nbsp;,&nbsp;logicalArg,&nbsp;)</span></code></div>
</div>
</li>
</ul>
</div>
<div class="section" id="packages">
<h1>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h1>
<p>One of the killer apps of R is the extensive collection of add-on
packages on <a class="reference external" href="http://www.cran.r-project.org">CRAN
(www.cran.r-project.org)</a> that provide
much of R’s functionality. To make use of a package it needs to be
installed on your system (using <em>install.packages()</em> once only) and
loaded into R (using <em>library()</em> every time you start R).</p>
<p>Some packages are <em>installed</em> by default with R and of these, some are
<em>loaded</em> by default, while others require a call to <em>library()</em>. For
packages I use a lot, I install them once and then load them
automatically every time I start R using my <em>~/.Rprofile</em> file.</p>
<div class="section" id="loading-packages">
<h2>Loading packages<a class="headerlink" href="#loading-packages" title="Permalink to this headline">¶</a></h2>
<p>You can use <em>library()</em> to either (1) make a package available (loading
it), (2) get an overview of the package, or (3) (if called without
arguments) to see all the installed packages.</p>
<hr class="docutils" />
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<hr class="docutils" />
<p>Notice that some of the packages are in a system directory and some are
in my home directory. Packages often depend on other packages. In
general, if one package depends on another, R will load the dependency,
but if the dependency is installed locally (see below), R may not find
it automatically and you may have to use <em>library()</em> to load the
dependency first. <em>.libPaths()</em> shows where R looks for packages on your
system and <em>searchpaths()</em> shows where individual packages are loaded
from.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;/home/jarrod/usr/lib64/R/library&quot;</span>
<span class="c">## [2] &quot;/usr/lib64/R/library&quot;</span>
<span class="c">## [3] &quot;/usr/share/R/library&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;.GlobalEnv&quot;</span>
<span class="c">## [2] &quot;/home/jarrod/usr/lib64/R/library/knitr&quot;</span>
<span class="c">## [3] &quot;/usr/lib64/R/library/stats&quot;</span>
<span class="c">## [4] &quot;/usr/lib64/R/library/graphics&quot;</span>
<span class="c">## [5] &quot;/usr/lib64/R/library/grDevices&quot;</span>
<span class="c">## [6] &quot;/usr/lib64/R/library/utils&quot;</span>
<span class="c">## [7] &quot;/usr/lib64/R/library/datasets&quot;</span>
<span class="c">## [8] &quot;Autoloads&quot;</span>
<span class="c">## [9] &quot;/usr/lib64/R/library/base&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-packages">
<h2>Installing packages<a class="headerlink" href="#installing-packages" title="Permalink to this headline">¶</a></h2>
<p>If a package is on CRAN but not on your system, you can install it
easily (usually). You don’t need root permission on a machine to install
a package (though sometimes you run into hassles if you are installing
it just as a user, so if you have administrative privileges it may help
to use them). Of course in RStudio, you can install via the GUI.</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<p>Note that R will generally install the package in a reasonable place if
you omit the <em>lib</em> argument. You can also download the zipped source
file from CRAN and install from the file; see the help page for
<em>install.packages()</em>. On Windows and Mac, you’lll need to do something
like this:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<p>If you’ve downloaded the binary package (files ending in .tgz for Mac
and .zip for Windows), omit the <code class="docutils literal"><span class="pre">type=’source’</span></code> argument.</p>
<p>The difference between the source package and the binary package is that
the source package has the raw R (and C and Fortran, in some cases) code
while the binary package has all the code in a binary/non-text format,
including any C and Fortran code having been compiled.</p>
</div>
<div class="section" id="accessing-objects-from-packages">
<h2>Accessing objects from packages<a class="headerlink" href="#accessing-objects-from-packages" title="Permalink to this headline">¶</a></h2>
<p>The objects in a package (primarily functions, but also data) are in
their own workspaces, and are accessible after you load the package
using <em>library()</em>, but are not directly visible when you use <em>ls()</em>.
We’ll talk more about this when we talk about scope and environments. If
we want to see the objects in one of the other workspaces, we can do the
following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;.GlobalEnv&quot;        &quot;package:knitr&quot;</span>
<span class="c">## [3] &quot;package:stats&quot;     &quot;package:graphics&quot;</span>
<span class="c">## [5] &quot;package:grDevices&quot; &quot;package:utils&quot;</span>
<span class="c">## [7] &quot;package:datasets&quot;  &quot;Autoloads&quot;</span>
<span class="c">## [9] &quot;package:base&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] NA NA NA NA NA</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;acf&quot;        &quot;acf2AR&quot;     &quot;add.scope&quot;  &quot;add1&quot;</span>
<span class="c">## [5] &quot;addmargins&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="objects-in-r">
<h1>Objects in R<a class="headerlink" href="#objects-in-r" title="Permalink to this headline">¶</a></h1>
<p>We assign into an object using either ’<em>=</em>’ or ’<em>&lt;-</em>’. A rule of
thumb is that for basic assignments where you have an object name, then
the assignment operator, and then some code, ’<em>=</em>’ is fine, but
otherwise use ’<em>&lt;-</em>’.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##    user  system elapsed</span>
<span class="c">##   0.001   0.000   0.001</span>
</pre></div>
</div>
<p>Let’s look at these examples to understand the distinction between ’=’
and ’&lt;-’ when passing arguments to a function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## function (x, ...)</span>
<span class="c">## UseMethod(&quot;mean&quot;)</span>
<span class="c">## &lt;bytecode: 0x21627a0&gt;</span>
<span class="c">## &lt;environment: namespace:base&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<hr class="docutils" />
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<p>What can you tell me about what is going on in each case above?</p>
<p>One situation in which you want to use ’<em>&lt;-</em>’ is if it is being used
as part of an argument to a function, so that R realizes you’re not
indicating one of the function arguments, e.g.:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{``</span></code>)``</div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 0 1</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{``</span></code>)``<code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<hr class="docutils" />
<p>R often treats integers as numerics, but we can force R to store values
as integers:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;numeric&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;integer&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 2 3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;integer&quot;</span>
</pre></div>
</div>
<p>We convert between classes using variants on <em>as()</em>: e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1.00 2.73</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] a b c</span>
<span class="c">## Levels: a b c</span>
</pre></div>
</div>
<p>Some common conversions are converting numbers that are being
interpreted as characters into actual numbers, converting between
factors and characters, and converting between logical TRUE/FALSE
vectors and numeric 1/0 vectors. In some cases R will automatically do
conversions behind the scenes in a smart way (or occasionally not so
smart way). We saw see implicit conversion (also called coercion) when
we read in characters into R using <em>read.table()</em> - strings are often
automatically coerced to factors. Consider these examples of implicit
coercion:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 2</span>
</pre></div>
</div>
<p>In other languages, converting between different classes is sometimes
called <em>casting</em> a variable.</p>
<p>Here’s an example we can work through that will help illustrate how type
conversions occur behind the scenes in R.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -1.147  1.226  0.188  2.704  1.817</span>
</pre></div>
</div>
<p>You should be familiar with vectors as the basic data structure in R,
with character, integer, numeric, etc. classes. Objects also have a
type, which relates to what kind of values are in the objects and how
objects are stored internally in R (i.e., in C).</p>
<p>Let’s look at Adler’s Table 7.1 to see some other types.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;data.frame&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;list&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;matrix&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;integer&quot;</span>
</pre></div>
</div>
<p>Everything in R is an object and all objects have a class. For simple
objects class and type are often closely related, but this is not the
case for more complicated objects. The class describes what the object
contains and standard functions associated with it. In general, you
mainly need to know what class an object is rather than its type.
Classes can <em>inherit</em> from other classes; for example, the <em>glm</em> class
inherits characteristics from the <em>lm</em> class. We’ll see more on the
details of object-oriented programming in the R programming unit.</p>
<p>We can create objects with our own defined class.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;personClass&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;list&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;character&quot;</span>
</pre></div>
</div>
<p>Some functions that give information about objects are:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<hr class="docutils" />
<div class="highlight-python"><div class="highlight"><pre><span class="c">## List of 2</span>
<span class="c">##  $ firstname: chr &quot;Chris&quot;</span>
<span class="c">##  $ surname  : chr &quot;Paciorek&quot;</span>
<span class="c">##  - attr(*, &quot;class&quot;)= chr &quot;personClass&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $names</span>
<span class="c">## [1] &quot;firstname&quot; &quot;surname&quot;</span>
<span class="c">##</span>
<span class="c">## $class</span>
<span class="c">## [1] &quot;personClass&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;matrix&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;integer&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $dim</span>
<span class="c">## [1] 2 2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 2 2</span>
</pre></div>
</div>
<p><em>Attributes</em> are information about an object attached to an object as
something that looks like a named list. Attributes are often copied when
operating on an object. This can lead to some weird-looking formatting:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  2.5% 97.5%</span>
<span class="c">## -1.99  1.85</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## 2.5%</span>
<span class="c">## 1.01</span>
</pre></div>
</div>
<p>Thus in an subsequent operations with <em>qs</em>, the <em>names</em> attribute will
often get carried along. We can get rid of it:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -1.99  1.85</span>
</pre></div>
</div>
<p>A common use of attributes is that rows and columns may be named in
matrices and data frames, and elements in vectors:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;Mazda RX4&quot;         &quot;Mazda RX4 Wag&quot;</span>
<span class="c">## [3] &quot;Datsun 710&quot;        &quot;Hornet 4 Drive&quot;</span>
<span class="c">## [5] &quot;Hornet Sportabout&quot; &quot;Valiant&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot;</span>
<span class="c">##  [8] &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot; &quot;carb&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##        x y</span>
<span class="c">## first  1 3</span>
<span class="c">## second 2 4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## first</span>
<span class="c">##     7</span>
</pre></div>
</div>
<p>Objects exist in a workspace, which in R is called an environment.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;dat&quot;  &quot;dat2&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## 4000040 bytes</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## 3.8 Mb</span>
</pre></div>
</div>
<div class="section" id="special-objects">
<h2>Special objects<a class="headerlink" href="#special-objects" title="Permalink to this headline">¶</a></h2>
<p>There are also some special objects, which often begin with a period,
like hidden files in UNIX. One is <em>.Last.value</em>, which stores the last
result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1]  0.115 -0.873  0.705  1.272 -0.837 -1.394 -0.571</span>
<span class="c">##  [8]  1.058  0.960  0.200</span>
</pre></div>
</div>
</div>
<div class="section" id="scientific-notation">
<h2>Scientific notation<a class="headerlink" href="#scientific-notation" title="Permalink to this headline">¶</a></h2>
<p>R uses the syntax <em>“xep”</em> to mean <span class="math">\(x*10^{p}\)</span>.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
</div>
<div class="section" id="information-about-functions">
<h2>Information about functions<a class="headerlink" href="#information-about-functions" title="Permalink to this headline">¶</a></h2>
<p>To get help on functions (I’m having trouble evaluating these with
knitr, so just putting these in as text here):</p>
<div class="highlight-python"><div class="highlight"><pre>?lm # or help(lm)
help.search(&#39;lm&#39;)
apropos(&#39;lm&#39;)
help(&#39;[[&#39;) # operators are functions too
args(lm)
</pre></div>
</div>
</div>
<div class="section" id="strings-and-quotation">
<h2>Strings and quotation<a class="headerlink" href="#strings-and-quotation" title="Permalink to this headline">¶</a></h2>
<p>Working with strings and quotes (see <code class="docutils literal"><span class="pre">?Quotes</span></code> in R). Generally one
uses double quotes to denote text. If we want a quotation symbol in
text, we can do something like the following, either combining single
and double quotes or escaping the quotation:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<p>Be careful when cutting and pasting from documents that are not text
files as you may paste in something that looks like a single or double
quote, but which R cannot interpret as a quote because it’s some other
ASCII quote character.</p>
</div>
</div>
<div class="section" id="working-with-data-structures">
<h1>Working with data structures<a class="headerlink" href="#working-with-data-structures" title="Permalink to this headline">¶</a></h1>
<div class="section" id="extraction">
<h2>Extraction<a class="headerlink" href="#extraction" title="Permalink to this headline">¶</a></h2>
<p>You extract from lists with ``<em>[[</em>`` or with ``<em>[</em>``</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 3 4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $b</span>
<span class="c">## [1] 3 4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $a</span>
<span class="c">## [1] 1 2</span>
<span class="c">##</span>
<span class="c">## $sam</span>
<span class="c">## [1]  1.041  0.982 -1.014 -0.923</span>
</pre></div>
</div>
<p>When working with lists, it’s handy to be able to use the same function
on each element of the list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $a</span>
<span class="c">## [1] 2</span>
<span class="c">##</span>
<span class="c">## $b</span>
<span class="c">## [1] 2</span>
<span class="c">##</span>
<span class="c">## $sam</span>
<span class="c">## [1] 4</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##   a   b sam</span>
<span class="c">##   2   2   4</span>
</pre></div>
</div>
<p>Note that to operate on a data frame, which is a list, we’ll generally
want to use <em>lapply()</em> or <em>sapply()</em>, as <em>apply()</em> is really designed
for working with elements that are all of the same type:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##       Plant        Type   Treatment        conc</span>
<span class="c">## &quot;character&quot; &quot;character&quot; &quot;character&quot; &quot;character&quot;</span>
<span class="c">##      uptake</span>
<span class="c">## &quot;character&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $Plant</span>
<span class="c">## [1] &quot;ordered&quot; &quot;factor&quot;</span>
<span class="c">##</span>
<span class="c">## $Type</span>
<span class="c">## [1] &quot;factor&quot;</span>
<span class="c">##</span>
<span class="c">## $Treatment</span>
<span class="c">## [1] &quot;factor&quot;</span>
<span class="c">##</span>
<span class="c">## $conc</span>
<span class="c">## [1] &quot;numeric&quot;</span>
<span class="c">##</span>
<span class="c">## $uptake</span>
<span class="c">## [1] &quot;numeric&quot;</span>
</pre></div>
</div>
<p>Here’s a nice trick to pull out a specific component from each element
of a list. (Note the use of the additional argument(s) to <em>sapply()</em> -
this can also be done in the other <em>apply()</em> variants.)</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## a b c</span>
<span class="c">## 7 6 2</span>
</pre></div>
</div>
<p>Finally, we can flatten a list with <em>unlist()</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##     a1     a2     b1     b2   sam1   sam2   sam3</span>
<span class="c">##  1.000  2.000  3.000  4.000  1.041  0.982 -1.014</span>
<span class="c">##   sam4</span>
<span class="c">## -0.923</span>
</pre></div>
</div>
</div>
<div class="section" id="calculations-in-the-context-of-stratification">
<h2>Calculations in the context of stratification<a class="headerlink" href="#calculations-in-the-context-of-stratification" title="Permalink to this headline">¶</a></h2>
<p>Note that some of the basic R functionality for doing stratified
analysis is mentioned here. For a new way to do such split-apply-combine
operations see the <em>plyr</em> package.</p>
<p>We can also use an <em>apply()</em> variant to do calculations on subgroups,
defined based on a factor or factors.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##    4    6    8</span>
<span class="c">## 26.7 19.7 15.1</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      3    4    5</span>
<span class="c">## 4 21.5 26.9 28.2</span>
<span class="c">## 6 19.8 19.8 19.7</span>
<span class="c">## 8 15.1   NA 15.4</span>
</pre></div>
</div>
<p>Check out <em>aggregate()</em> and <em>by()</em> for nice wrappers to <em>tapply()</em> when
working with data frames. <em>aggregate()</em> returns a data frame and works
when the output of the function is univariate, while <em>by()</em> returns a
list, so can return multivariate output:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##   cyl  mpg cyl disp    hp drat   wt qsec    vs    am</span>
<span class="c">## 1   4 26.7   4  105  82.6 4.07 2.29 19.1 0.909 0.727</span>
<span class="c">## 2   6 19.7   6  183 122.3 3.59 3.12 18.0 0.571 0.429</span>
<span class="c">## 3   8 15.1   8  353 209.2 3.23 4.00 16.8 0.000 0.143</span>
<span class="c">##   gear carb</span>
<span class="c">## 1 4.09 1.55</span>
<span class="c">## 2 3.86 3.43</span>
<span class="c">## 3 3.29 3.50</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## warpbreaks$tension: L</span>
<span class="c">##</span>
<span class="c">## Call:</span>
<span class="c">## lm(formula = breaks ~ wool, data = x)</span>
<span class="c">##</span>
<span class="c">## Coefficients:</span>
<span class="c">## (Intercept)        woolB</span>
<span class="c">##        44.6        -16.3</span>
<span class="c">##</span>
<span class="c">## -----------------------------------------</span>
<span class="c">## warpbreaks$tension: M</span>
<span class="c">##</span>
<span class="c">## Call:</span>
<span class="c">## lm(formula = breaks ~ wool, data = x)</span>
<span class="c">##</span>
<span class="c">## Coefficients:</span>
<span class="c">## (Intercept)        woolB</span>
<span class="c">##       24.00         4.78</span>
<span class="c">##</span>
<span class="c">## -----------------------------------------</span>
<span class="c">## warpbreaks$tension: H</span>
<span class="c">##</span>
<span class="c">## Call:</span>
<span class="c">## lm(formula = breaks ~ wool, data = x)</span>
<span class="c">##</span>
<span class="c">## Coefficients:</span>
<span class="c">## (Intercept)        woolB</span>
<span class="c">##       24.56        -5.78</span>
</pre></div>
</div>
<p>In some cases you may actually need an object containing the subsets of
the data, for which you can use <em>split()</em>:</p>
<p>To stratify based on a continuous variable, you can create a factor with
the <em>cut()</em> function. By default the levels are not formally ordered,
but we can manipulate them with <em>relevel()</em>, or make sure they’re
ordered by using the <em>ordered_result</em> argument to <em>cut()</em>.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;low&quot;    &quot;medium&quot; &quot;high&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>The <em>do.call()</em> function will apply a function to the elements of a
list. For example, we can <em>rbind()</em> together (if compatible) the
elements of a list of vectors instead of having to loop over the
elements or manually type them in:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## function (..., deparse.level = 1)</span>
<span class="c">## NULL</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2] [,3]</span>
<span class="c">## [1,]    1    2    3</span>
<span class="c">## [2,]   11   12   13</span>
<span class="c">## [3,]   21   22   23</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##        a         b         c</span>
<span class="c">## myList Integer,3 Integer,3 Integer,3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##   [,1] [,2] [,3]</span>
<span class="c">## a    1    2    3</span>
<span class="c">## b   11   12   13</span>
<span class="c">## c   21   22   23</span>
</pre></div>
</div>
<p>Why couldn’t we just use <em>rbind()</em> directly? Basically we’re using
<em>do.call()</em> to use functions that take “...” as input (i.e., functions
accepting an arbitrary number of arguments) and to use the list as the
input instead (i.e., to use the list elements).</p>
<div class="section" id="vectors-and-matrices">
<h3>Vectors and matrices<a class="headerlink" href="#vectors-and-matrices" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="column-major-vs-row-major-matrix-storage">
<h2>Column-major vs. row-major matrix storage<a class="headerlink" href="#column-major-vs-row-major-matrix-storage" title="Permalink to this headline">¶</a></h2>
<p>Matrices in R are column-major ordered, which means they are stored by
column as a vector of concatenated columns.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<p>If you want to fill a matrix row-wise:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2]</span>
<span class="c">## [1,]    1    2</span>
<span class="c">## [2,]    3    4</span>
</pre></div>
</div>
<p>Column-major ordering is also used in Matlab and Fortran, while
row-major ordering is used in C.</p>
</div>
<div class="section" id="identifying-elements-by-index">
<h2>Identifying elements by index<a class="headerlink" href="#identifying-elements-by-index" title="Permalink to this headline">¶</a></h2>
<p>You can figure out the indices of elements having a given characteristic
using <em>which()</em>:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 3</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      row col</span>
<span class="c">## [1,]   1   1</span>
<span class="c">## [2,]   2   1</span>
</pre></div>
</div>
<p><em>which.max()</em> and <em>which.min()</em> have similar sort of functionality.</p>
<p>We can determine which elements match those in another set with <em>%in%</em>
(to return logicals) or <em>match()</em> (to return indices that describe the
mapping):</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">%in%</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</span>
<span class="c">##  [9] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="c">## [17] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="c">## [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">%in%</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1]  1  8 18</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1]  1 NA NA NA NA NA NA  2 NA NA NA NA NA NA NA NA NA</span>
<span class="c">## [18]  3 NA NA NA NA NA NA NA NA NA NA NA NA NA NA</span>
</pre></div>
</div>
</div>
<div class="section" id="vectorized-subsetting">
<h2>Vectorized subsetting<a class="headerlink" href="#vectorized-subsetting" title="Permalink to this headline">¶</a></h2>
<p>We can subset vectors, matrices, and rows of data frames by index or by
logical vectors.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1]  1.263 -0.326  1.330  1.272  0.415 -1.540 -0.929</span>
<span class="c">## [8] -0.295</span>
<span class="c">##          [,1]   [,2]   [,3]</span>
<span class="c">## [1,] -0.00577 -0.799 -0.299</span>
<span class="c">## [2,]  2.40465 -1.148 -0.412</span>
<span class="c">## [3,]  0.76359 -0.289  0.252</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -0.326 -1.540 -0.929 -0.295</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1.263 0.000 1.330 1.272 0.415 0.000 0.000 0.000</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -0.00577 -0.79901 -0.29922</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -0.799 -0.299</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##          [,1]   [,2]   [,3]</span>
<span class="c">## [1,] -0.00577 -0.799 -0.299</span>
<span class="c">## [2,]  2.40465 -1.148 -0.412</span>
<span class="c">## [3,]  0.76359 -0.289  0.252</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE  TRUE FALSE FALSE FALSE  TRUE  TRUE  TRUE</span>
<span class="c">## [1] 2 6 7 8</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 1</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 2 1</span>
</pre></div>
</div>
<p>Finally, we can also subset a matrix with a two-column matrix of
{row,column} indices.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -0.00577  0.76359 -0.69095</span>
</pre></div>
</div>
</div>
<div class="section" id="indexing-and-factors">
<h2>Indexing and factors<a class="headerlink" href="#indexing-and-factors" title="Permalink to this headline">¶</a></h2>
<p>Be careful of using factors as indices for subsetting:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## advanced</span>
<span class="c">##       13</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## minimal</span>
<span class="c">##       3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## advanced</span>
<span class="c">##       13</span>
</pre></div>
</div>
<p>What has gone wrong?</p>
</div>
<div class="section" id="apply">
<h2>apply()<a class="headerlink" href="#apply" title="Permalink to this headline">¶</a></h2>
<p>The <em>apply()</em> function will apply a given function to either the rows or
columns of a matrix or a set of dimensions of an array:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2] [,3]</span>
<span class="c">## [1,]    1    3    5</span>
<span class="c">## [2,]    2    4    6</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 2</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 3 5</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 3 5</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2] [,3] [,4]</span>
<span class="c">## [1,]    1    7   13   19</span>
<span class="c">## [2,]    3    9   15   21</span>
<span class="c">## [3,]    5   11   17   23</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">#&nbsp;&nbsp;for(j&nbsp;in&nbsp;1:3)&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">#&nbsp;&nbsp;&nbsp;for(k&nbsp;in&nbsp;1:4)&nbsp;{&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">}</span></code></div>
</div>
<p>This can get confusing, but can be very powerful. Basically, I’m
calculating the min for each element of the second dimension in the
second-to-last example and for each pair of elements in the first and
third dimensions in the final example. Caution: if the result of each
subcalculation is a vector, these will be <em>cbind()</em>’ed together
(recall column-major order), so if you used <em>apply()</em> on the row margin,
you’ll need to transpose the result.</p>
</div>
<div class="section" id="why-use-apply-lapply-etc">
<h2>Why use apply(), lapply(), etc.?<a class="headerlink" href="#why-use-apply-lapply-etc" title="Permalink to this headline">¶</a></h2>
<p>The various <em>apply()</em> functions (apply, lapply, sapply, tapply, etc.)
may be faster than a loop (when a substantial part of the work lies in
the overhead of the looping), but if the dominant part of the
calculation lies in the time required by the function on each of the
elements, then the main reason for using an <em>apply()</em> variant is code
clarity.</p>
<p>Here’s an example where <em>apply()</em> is not faster than a loop.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{mod</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">))</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##    user  system elapsed</span>
<span class="c">##   0.475   0.005   0.481</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">({out2</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">nCalcs){out2[i]</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">})</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##    user  system elapsed</span>
<span class="c">##   0.442   0.000   0.442</span>
</pre></div>
</div>
<div class="section" id="long-and-wide-formats">
<h3>Long and wide formats<a class="headerlink" href="#long-and-wide-formats" title="Permalink to this headline">¶</a></h3>
<p>Finally, we may want to convert between so-called ’long’ and ’wide’
formats, which are motivated by working with longitudinal data (multiple
observations per subject). The wide format has repeated measurements for
a subject in separate columns, while the long format has repeated
measurements in separate rows, with a column for differentiating the
repeated measurements. <em>stack()</em> converts from wide to long while
<em>unstack()</em> does the reverse. <strong>**</strong> <em>reshape()</em> <a href="#id1"><span class="problematic" id="id2">**</span></a>** is similar but
more flexible and it can go in either direction. The wide format is
useful for doing separate analyses by group, while the long format is
useful for doing a single analysis that makes use of the groups, such as
ANOVA or mixed models. Let’s use the precipitation data as an example.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>Check out <em>melt()</em> and <em>cast()</em> in the <em>reshape2</em> package for easier
argument formats than <em>reshape()</em>.</p>
</div>
<div class="section" id="linear-algebra">
<h3>Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this headline">¶</a></h3>
<p>We’ll focus on matrices here. A few helpful functions are <em>nrow()</em> and
<em>ncol()</em>, which tell the dimensions of the matrix. The <em>row()</em> and
<em>col()</em> functions will return matrices of the same size as the original,
but filled with the row or column number of each element. So to get the
upper triangle of a matrix, <em>X</em>, we can do:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##        [,1]   [,2]   [,3]</span>
<span class="c">## [1,] -1.525 -0.514 -0.225</span>
<span class="c">## [2,]  1.600 -0.953  1.804</span>
<span class="c">## [3,] -0.685 -0.338  0.354</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -1.525 -0.514 -0.953 -0.225  1.804  0.354</span>
</pre></div>
</div>
<p>See also the <em>upper.tri()</em> and <em>lower.tri()</em> functions, as well as the
<em>diag()</em> function. <em>diag()</em> is quite handy - you can extract the
diagonals, assign into the diagonals, or create a diagonal matrix:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -1.525 -0.953  0.354</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##        [,1]   [,2]   [,3]</span>
<span class="c">## [1,]  1.000 -0.514 -0.225</span>
<span class="c">## [2,]  1.600  1.000  1.804</span>
<span class="c">## [3,] -0.685 -0.338  1.000</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2] [,3] [,4]</span>
<span class="c">## [1,]    1    0    0    0</span>
<span class="c">## [2,]    0    1    0    0</span>
<span class="c">## [3,]    0    0    2    0</span>
<span class="c">## [4,]    0    0    0    2</span>
</pre></div>
</div>
<p>To transpose a matrix, use <em>t()</em>, e.g., <code class="docutils literal"><span class="pre">t(X).</span></code></p>
</div>
</div>
<div class="section" id="basic-operations">
<h2>Basic operations<a class="headerlink" href="#basic-operations" title="Permalink to this headline">¶</a></h2>
<p>The basic matrix-vector operations are:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">%%</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">%o%</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">#&nbsp;same&nbsp;as&nbsp;but&nbsp;faster&nbsp;than&nbsp;t(X)&nbsp;%%&nbsp;Y!</span></code></div>
</div>
<p>For inverses (<span class="math">\(X^{-1}\)</span>) and solutions of systems of linear
equations (<span class="math">\(X^{-1}y\)</span>):</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">#&nbsp;(inverse&nbsp;of&nbsp;X)&nbsp;%%&nbsp;y</span></code></div>
</div>
<p>Note that if all you need to do is solve the linear system, you should
never explicitly find the inverse, UNLESS you need the actual matrix,
e.g., to get a covariance matrix of parameters.</p>
<p>Otherwise, to find many solutions, all with the same matrix, <span class="math">\(X\)</span>,
you can use <em>solve()</em> with the second argument being a matrix with each
column a different ’y’ vector for which you want the solution.</p>
<p><em>solve()</em> is an example of using a matrix decomposition to solve a
system of equations (in particular the LU decomposition). We’ll defer
matrix decompositions (LU, Cholesky, eigendecomposition, SVD, QR) until
the numerical linear algebra unit.</p>
</div>
</div>
<div class="section" id="flow-control-and-logical-operations">
<h1>Flow control and logical operations<a class="headerlink" href="#flow-control-and-logical-operations" title="Permalink to this headline">¶</a></h1>
<p>Everyone should be familiar with the comparison operators, <em>&lt;</em><strong>*,*</strong>
<em>&lt;=</em><strong>*,*</strong> <em>&gt;</em><strong>*,*</strong> <em>&gt;=</em><strong>*,*</strong> <em>==</em><strong>*,*</strong> <em>!=</em>. Logical
operators are slightly trickier:</p>
<div class="section" id="logical-operators-for-vectors-and-subsetting">
<h2>Logical operators for vectors and subsetting<a class="headerlink" href="#logical-operators-for-vectors-and-subsetting" title="Permalink to this headline">¶</a></h2>
<p><em>&amp;</em> and <em>|</em> are the “AND” and “OR” operators used when subsetting -
they act in a vectorized way:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -1.46 -1.35 -2.07 -1.34</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</span>
</pre></div>
</div>
</div>
<div class="section" id="logical-operators-for-if-statements">
<h2>Logical operators for <em>if</em> statements<a class="headerlink" href="#logical-operators-for-if-statements" title="Permalink to this headline">¶</a></h2>
<p><em>&amp;&amp;</em> and <em>||</em> use only the first element of a vector and also proceed
from left to right, returning the result as soon as possible and then
ignoring the remaining comparisons (this can be handy because in some
cases the second condition may give an error if the first condition is
not passed). They are used in flow control (i.e., with <em>if</em> statements).
Let’s consider how the single and double operators differ:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## logical(0)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;this is buggy code&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;this is buggy code too, but runs w/o warnings&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;this code is correct and the condition is TRUE&quot;</span>
</pre></div>
</div>
<p>You can use ! to indicate negation:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE</span>
</pre></div>
</div>
<div class="section" id="if-statements">
<h3>If statements<a class="headerlink" href="#if-statements" title="Permalink to this headline">¶</a></h3>
<p>If statements are at the core of programming. In R, the syntax is
<code class="docutils literal"><span class="pre">if(condition)</span> <span class="pre">statement</span> <span class="pre">else</span> <span class="pre">other_statement</span></code>, e.g.,</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>When one of the statements is a single statement, you don’t need the
curly braces around that statement.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>An extension of <em>if</em> looks like:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code><code class="docutils literal"><span class="pre">{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -10</span>
</pre></div>
</div>
<p>Finally, be careful that <em>else</em> should not start its own line, unless it
is preceded by a closing brace on the same line. Why?</p>
<div class="highlight-python"><div class="highlight"><pre>if(x &gt; 7) {
    statement1 } # what happens at this point?
else{ # what happens now?
    statement2
}
</pre></div>
</div>
<p>There’s also the <em>ifelse()</em> function, which operates in a vectorized
fashion:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 0.000 0.000 0.000 0.769 1.698 0.000</span>
</pre></div>
</div>
<p>Common bugs in the condition of an if statement include the following:</p>
<ol class="arabic">
<li><p class="first">Only the first element of <em>condition</em> is evaluated. You should be
careful that <em>condition</em> is a single logical value and does not
evaluate to a vector as this would generally be a bug. [see p. 152 of
Chambers]</p>
</li>
<li><p class="first">Use <em>identical()</em> or <em>all.equal()</em> rather than “<em>==</em>” to ensure that
you deal properly with vectors and always get a single logical value
back. We’ll talk more about issues that can arise when comparing
decimal numbers on a computer later in the course.</p>
</li>
<li><p class="first">If <em>condition</em> includes some R code, it can fail and produce
something that is neither TRUE nor FALSE. Defensive programming
practice is to check the condition for validity.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">{</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">eps)&nbsp;{</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
</li>
</ol>
</div>
<div class="section" id="switch">
<h3>switch()<a class="headerlink" href="#switch" title="Permalink to this headline">¶</a></h3>
<p><em>switch()</em> is handy for choosing amongst multiple outcomes depending on
an input, avoiding a long set of if-else syntax. The first argument is a
statement that determines what choice is made and the second is a list
of the outcomes, in order or by name:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 3.16</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 0.628</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 0.915</span>
</pre></div>
</div>
</div>
<div class="section" id="loops">
<h3>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h3>
<p>Loops are at the core of programming in other functional languages, but
in R, we often try to avoid them as they’re often (but not always) slow.
In many cases looping can be avoided by using vectorized calculations,
versions of <em>apply()</em>, and other tricks. But sometimes they’re
unavoidable and for quick and dirty coding and small problems, they’re
fine. And in some cases they may be faster than other alternatives. One
case we’ve already seen is that in working with lists they may be faster
than their <em>lapply</em>-style counterpart, though often they will not be.</p>
<p>The workhorse loop is the <em>for</em> loop, which as the syntax:
<code class="docutils literal"><span class="pre">for(var</span> <span class="pre">in</span> <span class="pre">sequence)</span> <span class="pre">statement</span></code>, where, as with the <em>if</em> statement,
we need curly braces around the body of the loop if it contains more
than one valid R statement:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">nIts){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">%%</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Iteration 100 Thu Aug 20 11:34:45 2015</span>
<span class="c">## Iteration 200 Thu Aug 20 11:34:45 2015</span>
<span class="c">## Iteration 300 Thu Aug 20 11:34:45 2015</span>
<span class="c">## Iteration 400 Thu Aug 20 11:34:45 2015</span>
<span class="c">## Iteration 500 Thu Aug 20 11:34:45 2015</span>
</pre></div>
</div>
<p>Challenge: how do I do this much faster?</p>
<p>You can also loop over a non-numeric vector of values.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">))&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 4561</span>
<span class="c">## [1] 4628</span>
<span class="c">## [1] 4091</span>
</pre></div>
</div>
<p>Challenge: how can I do this faster?</p>
<p>Note that to print to the screen in a loop you explicitly need to use
<em>print()</em> or <em>cat()</em>; just writing the name of the object will not work.
This is similar to <em>if</em> statements and functions.</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<p>You can use the commands <em>break</em> (to end the looping) and <em>next</em> (to go
to the next iteration) to control the flow:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1</span>
<span class="c">## [1] 2</span>
<span class="c">## [1] 3</span>
<span class="c">## [1] 4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1</span>
<span class="c">## [1] 3</span>
<span class="c">## [1] 4</span>
<span class="c">## [1] 5</span>
</pre></div>
</div>
<p><em>while</em> loops are used less frequently, but can be handy:
<code class="docutils literal"><span class="pre">while(condition)</span> <span class="pre">statement</span></code>, e.g. in optimization. See p. 59 of
Venables and Ripley, 4th ed., whose code I’ve included in the demo code
file.</p>
<p>A common cause of bugs in for loops is when the range ends at zero or a
missing value:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="formulas">
<h1>Formulas<a class="headerlink" href="#formulas" title="Permalink to this headline">¶</a></h1>
<p>Formulas were initially introduced into R to specify linear models, but
are now used more generally.</p>
<p>Here are some examples of formulas in R, used to specify a model
structure:</p>
<ul>
<li><div class="first line-block">
<div class="line">Additive model:<a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">+</span> <span class="pre">x2</span> <span class="pre">+</span> <span class="pre">x3</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Additive model without the intercept:<a href="#id7"><span class="problematic" id="id8">``</span></a><a href="#id9"><span class="problematic" id="id10">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">+</span> <span class="pre">x2</span> <span class="pre">+</span> <span class="pre">x3</span> <span class="pre">-1</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">All the other variables in the data frame are used as
covariates:<a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">.</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">All possible interactions:<a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id17"><span class="problematic" id="id18">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">*</span> <span class="pre">x2</span> <span class="pre">*</span> <span class="pre">x3</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Only specified interactions (in this case <em>x1</em> by <em>x2</em>) (of course,
you’d rarely want to fit this without <em>x2</em>):<a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">+</span> <span class="pre">x3</span> <span class="pre">+</span> <span class="pre">x1:x2</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Creating a factor on the fly:<a href="#id23"><span class="problematic" id="id24">``</span></a><a href="#id25"><span class="problematic" id="id26">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">+</span> <span class="pre">factor(x2)</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Protecting arithmetic expressions:<a href="#id27"><span class="problematic" id="id28">``</span></a><a href="#id29"><span class="problematic" id="id30">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">+</span> <span class="pre">I(x1^2)</span> <span class="pre">+</span> <span class="pre">I(x1^3)</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Using functions of variables<a href="#id31"><span class="problematic" id="id32">``</span></a><a href="#id33"><span class="problematic" id="id34">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x1</span> <span class="pre">+</span> <span class="pre">log(x2)</span> <span class="pre">+</span> <span class="pre">sin(x3)</span></code></div>
</div>
</li>
</ul>
<p>In some contexts, such as <em>lattice</em> package graphics, the “|” indicates
conditioning, so <code class="docutils literal"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">x</span> <span class="pre">|</span> <span class="pre">z</span></code> would mean to plot <em>y</em> on <em>x</em> within
groups of <em>z</em>. In the context of lme-related packages (e.g., <em>lme4</em>,
<em>nlme</em>, etc.), variables after “|” are <em>grouping</em> variables (e.g., if
you have a random effect for each hospital, hospital would be the
grouping variable) and multiple grouping variables are separated by
“<em>/</em>”.</p>
<p>We can manipulate formulae as objects, allowing automation. Consider how
this sort of thing could be used to write code for automated model
selection.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){&nbsp;covTerms</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## y ~ x1 + x2 + x3 + x4 + x5</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;formula&quot;</span>
</pre></div>
</div>
<p>The for loop is a bit clunky/inefficient - let’s do better:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## y ~ x1 + x2 + x3 + x4 + x5</span>
</pre></div>
</div>
<p>Standard arguments in model fitting functions, in addition to the
formula are <em>weights</em>, <em>data</em> (indicating the data frame in which to
interpret the variable names), <em>subset</em> (for using a subset of data),
and <em>na.action</em>. Note that the default <em>na.action</em> in R is set in
<em>options()$na.action</em> and is <em>na.omit</em>, so be wary in fitting models in
that you are dropping cases with NAs and may not be aware of it.</p>
<p>There is some more specialized syntax given in <em>R-intro.pdf</em> on CRAN.</p>
</div>
<div class="section" id="functions-variable-scoping-and-frames">
<h1>Functions, variable scoping, and frames<a class="headerlink" href="#functions-variable-scoping-and-frames" title="Permalink to this headline">¶</a></h1>
<p>Functions are at the heart of R. In general, you should try to have
functions be self-contained - operating only on arguments provided to
them, and producing no side effects, though in some cases there are good
reasons for making an exception.</p>
<p>Functions that are not implemented internally in R (i.e., user-defined
functions) are also referred to offically as <em>closures</em> (this is their
<em>type</em>) - this terminology sometimes comes up in error messages.</p>
<p>Arguments can be specifed in the correct order, or given out of order by
specifying <em>name = value</em>. In general the more important arguments are
specified first. You can see the arguments and defaults for a function
using <em>args()</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## function (formula, data, subset, weights, na.action, method = &quot;qr&quot;,</span>
<span class="c">##     model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE,</span>
<span class="c">##     contrasts = NULL, offset, ...)</span>
<span class="c">## NULL</span>
</pre></div>
</div>
<p>Functions may have unspecified arguments, which is designated using
’...’. Unspecified arguments occurring at the beginning of the argument
list are generally a collection of like objects that will be manipulated
(consider <em>paste()</em>, <em>c()</em>, and <em>rbind()</em>), while unspecified arguments
occurring at the end are often optional arguments (consider <em>plot()</em>).
These optional arguments are sometimes passed along to a function within
the function. For example, here’s my own wrapper for plotting, where any
additional arguments specified by the user will get passed along to
plot:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>If you want to manipulate what the user passed in as the <em>...</em> args,
rather than just passing them along, you can extract them (the following
code would be used within a function to which <em>’...’</em> is an argument:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 3</span>
<span class="c">## [1] 3</span>
</pre></div>
</div>
<p>You can check if an argument is missing with <em>missing()</em>. Arguments can
also have default values, which may be <em>NULL</em>. If you are writing a
function and designate the default as <em>argname = NULL</em>, you can check
whether the user provided anything using`` is.null(argname).`` The
default values can also relate to other arguments. As an example,
consider <em>dgamma()</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## function (x, shape, rate = 1, scale = 1/rate, log = FALSE)</span>
<span class="c">## NULL</span>
</pre></div>
</div>
<p>Functions can be passed in as arguments (e.g., see the variants of
<em>apply()</em>). Note that one does not need to pass in a named function -
you can create the function on the spot - this is called an <em>anonymous
function</em> (also called a <em>lambda function</em> in some languages such as
Python):</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2] [,3]</span>
<span class="c">## [1,]    0    0    0</span>
<span class="c">## [2,]    1    1    1</span>
<span class="c">## [3,]    2    2    2</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      [,1] [,2] [,3]</span>
<span class="c">## [1,]    0    0    0</span>
<span class="c">## [2,]    3    3    3</span>
<span class="c">## [3,]    6    6    6</span>
</pre></div>
</div>
<p>We can see the arguments using <em>args()</em> and extract the arguments using
<em>formals().</em> <em>formals()</em> can be helpful if you need to manipulate the
arguments.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">y)&nbsp;{&nbsp;x</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## function (x, y = 2, z = 3/y)</span>
<span class="c">## NULL</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## $x</span>
<span class="c">##</span>
<span class="c">##</span>
<span class="c">## $y</span>
<span class="c">## [1] 2</span>
<span class="c">##</span>
<span class="c">## $z</span>
<span class="c">## 3/y</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;pairlist&quot;</span>
</pre></div>
</div>
<p><em>match.call()</em> will show the user-suppled arguments explicitly matched
to named arguments.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## mean(x = y, na.rm = TRUE)</span>
</pre></div>
</div>
<div class="section" id="pass-by-value-vs-pass-by-reference">
<h2>Pass by value vs. pass by reference<a class="headerlink" href="#pass-by-value-vs-pass-by-reference" title="Permalink to this headline">¶</a></h2>
<p>Note that R makes a copy of all objects that are arguments to a
function, with the copy residing in the frame (the environment) of the
function (we’ll see more about frames just below). This is a case of
<em>pass by value</em> <a class="footnote-reference" href="#id44" id="id35">[1]</a>. In other languages it is also possible to <em>pass
by reference</em>, in which case, changes to the object made within the
function affect the value of the argument in the calling environment.
R’s designers chose not to allow pass by reference because they didn’t
like the idea that a function could have the side effect of changing an
object. However, passing by reference can sometimes be very helpful, and
we’ll see ways of passing by reference in Unit 6 on R programming.</p>
<p>An important exception is <em>par()</em>. If you change graphics parameters by
calling <em>par()</em> in a user-defined function, they are changed permanently
outside of the function. One trick is as follows:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">(){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>Note that changing graphics parameters within a specific plotting
function - e.g., <code class="docutils literal"><span class="pre">plot(x,</span> <span class="pre">y,</span> <span class="pre">pch</span> <span class="pre">=</span> <span class="pre">’+’)</span></code>, doesn’t change things except
for that particular plot.</p>
<div class="section" id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">return(x)</span></code> will specify <em>x</em> as the output of the function. By
default, if <em>return()</em> is not specified, the output is the result of the
last evaluated statement. <em>return()</em> can occur anywhere in the function,
and allows the function to exit as soon as it is done.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{&nbsp;res</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 9</span>
</pre></div>
</div>
<p><em>invisible(x)</em> will return <em>x</em> and the result can be assigned in the
calling environment but it will not be printed if not assigned:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">){</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 9</span>
</pre></div>
</div>
<p>A function can only return a single object (unlike Matlab, e.g.), but of
course we can tack things together as a list and return that, as with
<em>lm()</em> and many other functions.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;lm&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] TRUE</span>
</pre></div>
</div>
</div>
<div class="section" id="variable-scope">
<h3>Variable scope<a class="headerlink" href="#variable-scope" title="Permalink to this headline">¶</a></h3>
<p>To consider variable scope, we need to define the terms <em>environment</em>
and <em>frame</em>. Environments and frames are closely related.</p>
<ul class="simple">
<li>A <em>frame</em> is a collection of named objects.</li>
<li>An <em>environment</em> is a frame, with a pointer to the ’enclosing
environment’, i.e., the next environment to look for something in.
(Be careful as this is different than the parent frame of a
function.)</li>
</ul>
<p>Variables in the enclosing environment (the environment in which a
function is defined, also called the parent environment) are available
within a function. This is the analog of <em>global variables</em> in other
languages. Note that enclosing/parent environment is NOT the environment
from which the function was called. This is called <em>lexical scoping</em>.</p>
<p>Be careful when using variables from the enclosing environment as the
value of that variable in the enclosing environment may well not be what
you expect it to be. In general it’s bad practice to use variables that
are taken from environments outside that of a function, but it some
cases it can be useful.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{x</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<p>Here are some examples to illustrate scope:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<p>Here’s a somewhat tricky example:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">(){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 13</span>
</pre></div>
</div>
<p>Let’s work through this:</p>
<ol class="arabic simple">
<li>What is the enclosing environment of the function <em>g()</em>?</li>
<li>What does <em>g()</em> use for <em>y</em>?</li>
<li>When <em>f()</em> finishes, does its environment disappear? What would
happen if it did?</li>
<li>What is the enclosing environment of <em>h()</em>?</li>
</ol>
<p>This code helps explain things, but it’s a bit confusing because
<em>environment()</em> gives back different results depending on whether it is
given a function as its argument.</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## &lt;environment: 0x2029fe0&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;g&quot; &quot;y&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">(){</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## &lt;environment: 0x16571a8&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## &lt;environment: 0x16571a8&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 13</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 10</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## function(x) x + y</span>
<span class="c">## &lt;environment: 0x16571a8&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="where-are-arguments-evaluated">
<h2>Where are arguments evaluated?<a class="headerlink" href="#where-are-arguments-evaluated" title="Permalink to this headline">¶</a></h2>
<p>User-supplied arguments are evaluated in the calling frame, while
default arguments are evaluated in the frame of the function:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{x</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 60</span>
</pre></div>
</div>
<p>Here, when <em>f()</em> is called, <em>z</em> is evaluated in the calling frame and
<code class="docutils literal"><span class="pre">z*5</span></code> is assigned to <em>x</em> in the frame of the function, while
<code class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">x*3</span></code> is evaluated in the frame of the function.</p>
</div>
<div class="section" id="comprehension-problem">
<h2>Comprehension problem<a class="headerlink" href="#comprehension-problem" title="Permalink to this headline">¶</a></h2>
<p>Here’s a case where something I tried failed and I had to think more
carefully about scoping to understand why.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1.26</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] -0.326</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1.33</span>
</pre></div>
</div>
<p>Question: what was I hoping that code to do, and why didn’t it work?</p>
<div class="section" id="environments-and-the-search-path">
<h3>Environments and the search path<a class="headerlink" href="#environments-and-the-search-path" title="Permalink to this headline">¶</a></h3>
<p>So far we’ve seen lexical scoping in action primarily in terms of
finding variables in a single enclosing environment. But what if the
variable is not found in either the frame/environment of the function or
the enclosing environment? When R goes looking for an object (in the
form of a symbol), it starts in the current environment (e.g., the
frame/environment of a function) and then runs up through the enclosing
environments, until it reaches the global environment, which is where R
starts when you open R (it actually continues further up; see below). In
general, as we’ve seen, these are <em>not</em> the frames on the stack (see the
next Section).</p>
<p>By default objects are created in the global environment, <em>.GlobalEnv</em>.
As we’ve seen, the environment within a function call has as its
enclosing environment the environment where the function was defined
(not the environment from which it was called), and this is next place
that is searched if an object can’t be found in the frame of the
function call. This is called lexical scoping (and differs from the S
language on which R was based). As an example, if an object couldn’t be
found within the environment of an <em>lm()</em> function call, R would first
look in the environment (also called the namespace) of the stats package
(since this is the environment where <em>lm()</em> is defined and is therefore
the enclosing environment for <em>lm()</em>), then in packages imported by the
stats package, then the base package, and then the global environment.</p>
<p>If R can’t find the object when reaching the global environment, it runs
through the search path, which you can see with <em>search()</em>. The search
path is a set of additional environments. Generally packages are created
with namespaces, i.e., each has its own environment, as we see based on
<em>search()</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;.GlobalEnv&quot;        &quot;package:knitr&quot;</span>
<span class="c">## [3] &quot;package:stats&quot;     &quot;package:graphics&quot;</span>
<span class="c">## [5] &quot;package:grDevices&quot; &quot;package:utils&quot;</span>
<span class="c">## [7] &quot;package:datasets&quot;  &quot;Autoloads&quot;</span>
<span class="c">## [9] &quot;package:base&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;.GlobalEnv&quot;</span>
<span class="c">## [2] &quot;/home/jarrod/usr/lib64/R/library/knitr&quot;</span>
<span class="c">## [3] &quot;/usr/lib64/R/library/stats&quot;</span>
<span class="c">## [4] &quot;/usr/lib64/R/library/graphics&quot;</span>
<span class="c">## [5] &quot;/usr/lib64/R/library/grDevices&quot;</span>
<span class="c">## [6] &quot;/usr/lib64/R/library/utils&quot;</span>
<span class="c">## [7] &quot;/usr/lib64/R/library/datasets&quot;</span>
<span class="c">## [8] &quot;Autoloads&quot;</span>
<span class="c">## [9] &quot;/usr/lib64/R/library/base&quot;</span>
</pre></div>
</div>
<p>We can also see the nestedness of environments using the following code,
using <em>environmentName()</em>, which prints out a nice-looking version of
the environment name.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## &lt;environment: package:knitr&gt;</span>
<span class="c">## attr(,&quot;name&quot;)</span>
<span class="c">## [1] &quot;package:knitr&quot;</span>
<span class="c">## attr(,&quot;path&quot;)</span>
<span class="c">## [1] &quot;/home/jarrod/usr/lib64/R/library/knitr&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()))&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;R_GlobalEnv&quot;</span>
<span class="c">## [1] &quot;package:knitr&quot;</span>
<span class="c">## [1] &quot;package:stats&quot;</span>
<span class="c">## [1] &quot;package:graphics&quot;</span>
<span class="c">## [1] &quot;package:grDevices&quot;</span>
<span class="c">## [1] &quot;package:utils&quot;</span>
<span class="c">## [1] &quot;package:datasets&quot;</span>
<span class="c">## [1] &quot;Autoloads&quot;</span>
<span class="c">## [1] &quot;base&quot;</span>
</pre></div>
</div>
<p>Note that eventually the global environment and the environments of the
packages are nested within the base environment (of the base package)
and the empty environment. Note that here <em>parent</em> <strong>is</strong> referring to
the enclosing environment, even though it is best to talk about
<em>enclosing environment</em> rather than parent environment.</p>
<p>We can look at the objects of an environment as follows:</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] NA NA NA NA NA</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;acf&quot;        &quot;acf2AR&quot;     &quot;add.scope&quot;  &quot;add1&quot;</span>
<span class="c">## [5] &quot;addmargins&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## &lt;environment: namespace:stats&gt;</span>
</pre></div>
</div>
<p>The enclosing environments for a function from an attached package are a
bit more complicated:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## &lt;environment: namespace:stats&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()))&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;stats&quot;</span>
<span class="c">## [1] &quot;imports:stats&quot;</span>
<span class="c">## [1] &quot;base&quot;</span>
<span class="c">## [1] &quot;R_GlobalEnv&quot;</span>
<span class="c">## [1] &quot;package:knitr&quot;</span>
<span class="c">## [1] &quot;package:stats&quot;</span>
<span class="c">## [1] &quot;package:graphics&quot;</span>
<span class="c">## [1] &quot;package:grDevices&quot;</span>
<span class="c">## [1] &quot;package:utils&quot;</span>
<span class="c">## [1] &quot;package:datasets&quot;</span>
<span class="c">## [1] &quot;Autoloads&quot;</span>
<span class="c">## [1] &quot;base&quot;</span>
</pre></div>
</div>
<p>We can retrieve and assign objects in a particular environment as
follows:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>Note that our (bogus) <em>lm()</em> function masks but does not overwrite the
default function. If we remove ours, then the default one is still
there.</p>
</div>
<div class="section" id="frames-and-the-call-stack">
<h3>Frames and the call stack<a class="headerlink" href="#frames-and-the-call-stack" title="Permalink to this headline">¶</a></h3>
<p>R keeps track of the call stack, which is the set of nested calls to
functions. The stack operates like a stack of cafeteria trays - when a
function is called, it is added to the stack (pushed) and when it
finishes, it is removed (popped). There are a bunch of functions that
let us query what frames are on the stack and access objects in
particular frames of interest. This gives us the ability to work with
objects in the environment(s) from which a function was called.</p>
<p><em>sys.nframe()</em> returns the number of the current frame and
<em>sys.parent()</em> the number of the parent, while parent.frame() gives the
name of the environment of the parent frame. Careful: here, <em>parent</em>
refers to the parent in terms of the call stack and has nothing to do
with enclosing environments. <em>sys.frame()</em> gives the name of the
environment for a given frame number (for non-negative numbers). For
negative numbers, it goes back that many frames in the call stack and
returns the name of the associated environment. I won’t print the
results here because <em>knitr</em> messes up the frame counting somehow.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>Now let’s look at some code that gets more information about the call
stack and the frames involved using <em>sys.status()</em>, <em>sys.calls()</em>,
<em>sys.parents()</em> and <em>sys.frames()</em>.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">)&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code><code class="docutils literal"><span class="pre">()&nbsp;{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<p>Challenge: why did I not do <code class="docutils literal"><span class="pre">print(sys.status())</span></code> directly?</p>
<p>If you’re interested in parsing a somewhat complicated example of frames
in action, Adler provides a user-defined timing function that evaluates
statements in the calling frame.</p>
</div>
<div class="section" id="with-and-within">
<h3>with() and within()<a class="headerlink" href="#with-and-within" title="Permalink to this headline">¶</a></h3>
<p><em>with()</em> provides a clean way to use a function (or any R code,
specified as R statements enclosed within {}, unless you are evaluating
a single expression as in the demo here) within the context of a data
frame (or an environment). <em>within()</em> is similar, evaluating within the
context of a data frame or a list, but it allows you to modify the data
frame (or list) and returns the result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1] 126.0 126.0  91.2 128.4 149.6 108.6 114.4  97.6</span>
<span class="c">##  [9]  91.2 115.2 106.8 131.2 138.4 121.6  83.2  83.2</span>
<span class="c">## [17] 117.6 129.6 121.6 135.6  86.0 124.0 121.6 106.4</span>
<span class="c">## [25] 153.6 109.2 104.0 121.6 126.4 118.2 120.0  85.6</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##  [1] &quot;mpg&quot;   &quot;cyl&quot;   &quot;disp&quot;  &quot;hp&quot;    &quot;drat&quot;  &quot;wt&quot;</span>
<span class="c">##  [7] &quot;qsec&quot;  &quot;vs&quot;    &quot;am&quot;    &quot;gear&quot;  &quot;carb&quot;  &quot;crazy&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="summing-up">
<h3>Summing up<a class="headerlink" href="#summing-up" title="Permalink to this headline">¶</a></h3>
<p>What happens when an R function is evaluated? The user-provided function
arguments are matched to the argument names in the function definition.
A new environment is created, and assignment to those names is done in
the environment, including any default arguments. The body of the
function is evaluated in the environment.</p>
</div>
</div>
</div>
<div class="section" id="text-manipulations-and-regular-expressions">
<h1>Text manipulations and regular expressions<a class="headerlink" href="#text-manipulations-and-regular-expressions" title="Permalink to this headline">¶</a></h1>
<p>Text manipulations in R have a number of things in common with Perl,
Python and UNIX, as many of these evolved from UNIX. When I use the term
<em>string</em> here, I’ll be refering to any sequence of characters that may
include numbers, white space, and special characters, rather than to the
character class of R objects. The string or strings will generally be
stored as R character vectors.</p>
<p>A few of the basic R functions for manipulating strings are <em>paste()</em>,
<em>strsplit()</em>, and <em>substring()</em>. <em>paste()</em> and <em>strsplit()</em> are
basically inverses of each other: <em>paste()</em> concatenates together an
arbitrary set of strings (or a vector, if using the <em>collapse</em> argument)
with a user-specified separator character, while <em>strsplit()</em> splits
apart based on a delimiter/separator. <a href="#id36"><span class="problematic" id="id37">**</span></a>** <em>substring()</em> splits apart
the elements of a character vector based on fixed widths. Note that all
of these operate in a vectorized fashion.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;My name is Chris .&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## [1] &quot;My&quot;    &quot;name&quot;  &quot;is&quot;    &quot;Chris&quot; &quot;.&quot;</span>
</pre></div>
</div>
<p>Note that <em>strsplit()</em> returns a list because it can operate on a
character vector (i.e., on multiple strings).</p>
<p><em>nchar()</em> tells the number of characters in a string.</p>
<p>To identify particular subsequences in strings, there are several
related R functions. <em>grep()</em> will look for a specified string within an
R character vector and report back indices identifying the elements of
the vector in which the string was found in (using the <em>fixed=TRUE</em>
argument ensures that regular expressions are NOT used). <em>gregexpr()</em>
will indicate the position in each string that the specified string is
found (use <em>regexpr()</em> if you only want the first occurrence). <em>gsub()</em>
can be used to replace a specified string with a replacement string (use
<em>sub()</em> if you only want to replace only the first occurrence).</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;&quot;   &quot;CA&quot; &quot;OH&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] 1 2 3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## [1] 5</span>
<span class="c">## attr(,&quot;match.length&quot;)</span>
<span class="c">## [1] 2</span>
<span class="c">## attr(,&quot;useBytes&quot;)</span>
<span class="c">## [1] TRUE</span>
<span class="c">##</span>
<span class="c">## [[2]]</span>
<span class="c">## [1] 5</span>
<span class="c">## attr(,&quot;match.length&quot;)</span>
<span class="c">## [1] 2</span>
<span class="c">## attr(,&quot;useBytes&quot;)</span>
<span class="c">## [1] TRUE</span>
<span class="c">##</span>
<span class="c">## [[3]]</span>
<span class="c">## [1]  2 11</span>
<span class="c">## attr(,&quot;match.length&quot;)</span>
<span class="c">## [1] 2 2</span>
<span class="c">## attr(,&quot;useBytes&quot;)</span>
<span class="c">## [1] TRUE</span>
<span class="c">##</span>
<span class="c">## [[4]]</span>
<span class="c">## [1] -1</span>
<span class="c">## attr(,&quot;match.length&quot;)</span>
<span class="c">## [1] -1</span>
<span class="c">## attr(,&quot;useBytes&quot;)</span>
<span class="c">## [1] TRUE</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;date04&quot;       &quot;size04&quot;       &quot;x04weights04&quot;</span>
<span class="c">## [4] &quot;sdfsd&quot;</span>
</pre></div>
</div>
<p>The <em>stringr</em> package wraps the various core string manipulation
functions to provide a common interface. It also removes some of the
clunkiness involved in some of the string operations with the base
string functions, such as having to to call <em>gregexpr()</em> and then
<em>regmatches()</em> to pull out the matched strings. For PS3 and your future
endeavors, I’d suggest using <em>stringr</em> functions in place of R’s base
string functions.</p>
<p>The basic interface is <code class="docutils literal"><span class="pre">function(strings,</span> <span class="pre">pattern,</span> <span class="pre">[replace])</span></code>.</p>
<p>Table 1 provides an overview of the key functions, which are basically
wrappers for <em>grep()</em>, <em>gsub()</em>, <em>gregexpr()</em>, etc.</p>
<p>|c|&gt;p5in| Function &amp; What it does
str_detect &amp; detects pattern, returning TRUE/FALSE
str_count &amp; counts matches
str_locate/str_locate_all &amp; detects pattern, returning positions of
matching characters
str_extract/str_extract_all &amp; detects pattern, returning matches
str_replace/str_replace_all &amp; detects pattern and replaces matches</p>
<p>The analogue of <em>regexpr()</em> vs. <em>gregexpr()</em> and <em>sub()</em> vs. <em>gsub()</em> is
that most of the functions have versions that return all the matches,
not just the first match, e.g. <em>str_locate_all()</em>,
<em>str_extract_all(),</em> etc. Note that the _all functions return lists
while the non-_all functions return vectors.</p>
<p>To specify options, you can wrap these functions around the pattern
argument: <code class="docutils literal"><span class="pre">fixed(pattern)</span></code>, <code class="docutils literal"><span class="pre">ignore.case(pattern)</span></code>, and
<code class="docutils literal"><span class="pre">perl(pattern)</span></code>. For example,</p>
<p><a href="#id38"><span class="problematic" id="id39">**</span></a></p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<p><a href="#id40"><span class="problematic" id="id41">**</span></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      start end</span>
<span class="c">## [1,]     1   3</span>
<span class="c">## [2,]    NA  NA</span>
<span class="c">## [3,]     1   3</span>
</pre></div>
</div>
<div class="section" id="overview-and-core-syntax">
<h2>Overview and core syntax<a class="headerlink" href="#overview-and-core-syntax" title="Permalink to this headline">¶</a></h2>
<p>The <em>grep()</em>, <em>gregexpr()</em> and <em>gsub()</em> functions and their <em>stringr</em>
analogs are more powerful when used with regular expressions. Regular
expressions are a domain-specific language for finding patterns and are
one of the key functionalities in scripting languages such as Perl and
Python, as well as the UNIX utilities <em>sed</em>, <em>awk</em> and <em>grep</em>. Duncan
Temple Lang (UC Davis Statistics) has written a nice tutorial that I’ve
put in the repository (<em>regexpr-Lang.pdf</em>) or check out Sections 9.9 and
11 of Murrell. We’ll just cover the use of regular expressions in R, but
once you know that, it would be easy to use them elsewhere (Python, grep
and other UNIX commands, etc.). What I describe here is the “extended
regular expression” syntax (POSIX 1003.2), but with the argument
<code class="docutils literal"><span class="pre">Perl=TRUE</span></code> or <code class="docutils literal"><span class="pre">perl(pattern)</span></code> in <em>stringr</em>, you can get Perl-style
regular expressions. At the level we’ll consider them, the syntax is
quite similar.</p>
<p>The basic idea of regular expressions is that they allow us to find
matches of strings or patterns in strings, as well as do substitution.
Regular expressions are good for tasks such as:</p>
<ul class="simple">
<li>extracting pieces of text - for example finding all the links in an
html document;</li>
<li>creating variables from information found in text;</li>
<li>cleaning and transforming text into a uniform format;</li>
<li>mining text by treating documents as data; and</li>
<li>scraping the web for data.</li>
</ul>
<p>Regular expressions are constructed from three things:</p>
<p><em>Literal characters</em> are matched only by the characters themselves,</p>
<p><em>Character classes</em> are matched by any single member in the class, and</p>
<p><em>Modifiers</em> operate on either of the above or combinations of them.</p>
<p>Note that the syntax is very concise, so it’s helpful to break down
individual regular expressions into the component parts to understand
them. As Murrell notes, since regexp are their own language, it’s a good
idea to build up a regexp in pieces as a way of avoiding errors just as
we would with any computer code. <em>gregexpr()</em> is particularly useful in
seeing <strong>what</strong> was matched to help in understanding and learning
regular expression syntax and debugging your regexp.</p>
<p>The special characters (meta-characters) used for defining regular
expressions are: <em>* . ^ $ + ? ( ) [ ] { } | \</em> . To use these
characters literally as characters, we have to ’escape’ them. In R, we
have to use two backslashes insstead of a single backslash because R
uses a single backslash to symbolize certain control characters, such as
<em>\n</em> for newline. Outside of R, one would only need a single backslash.</p>
</div>
<div class="section" id="character-sets-and-character-classes">
<h2>Character sets and character classes<a class="headerlink" href="#character-sets-and-character-classes" title="Permalink to this headline">¶</a></h2>
<p>If we want to search for any one of a set of characters, we use a
character set, such as <code class="docutils literal"><span class="pre">[13579]</span></code> or <code class="docutils literal"><span class="pre">[abcd]</span></code> or <code class="docutils literal"><span class="pre">[0-9]</span></code> (where the
dash indicates a sequence) or <code class="docutils literal"><span class="pre">[0-9a-z]</span></code> or <code class="docutils literal"><span class="pre">[</span> <span class="pre">\t]</span></code>. To indicate any
character not in a set, we place a ^ just inside the first bracket:
<code class="docutils literal"><span class="pre">[^abcd]</span></code>. The period stands for any character.</p>
<p>There are a bunch of named character classes so that we don’t have write
out common sets of characters. The syntax is <code class="docutils literal"><span class="pre">[:class:]</span></code> where <em>class</em>
is the name of the class. The classes include the <em>digit</em>, <em>alpha</em>,
<em>alnum</em>, <em>lower</em>, <em>upper</em>, <em>punct</em>, <em>blank</em>, <em>space</em> (see <code class="docutils literal"><span class="pre">?regexp</span></code> in
R for formal definitions of all of these, but most are fairly
self-explanatory). To make a character set with a character class you
need two square brackets, e.g. the digit class: <code class="docutils literal"><span class="pre">[[:digit:]]</span></code>. Or we
can make a combined character set such as <code class="docutils literal"><span class="pre">[[:alnum:]_]</span></code>. E.g., the
latter would be useful in looking for email addresses. If you use the
<code class="docutils literal"><span class="pre">[:class:]</span></code> syntax, you need to use the <code class="docutils literal"><span class="pre">perl=TRUE</span></code> argument to the
relevant function to make use of Perl-style regular expressions.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<p><a href="#id42"><span class="problematic" id="id43">**</span></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE  TRUE  TRUE</span>
</pre></div>
</div>
<p>Some synonyms for the various classes are: <code class="docutils literal"><span class="pre">\\w</span></code> = <code class="docutils literal"><span class="pre">[:alnum:]</span></code>,
<code class="docutils literal"><span class="pre">\\W</span></code> = <code class="docutils literal"><span class="pre">^[:alnum:]</span></code>, <code class="docutils literal"><span class="pre">\\d</span> <span class="pre">=</span> <span class="pre">[:digit]</span></code>, <code class="docutils literal"><span class="pre">\\D</span></code> = <code class="docutils literal"><span class="pre">^[:digit:]</span></code>,
<code class="docutils literal"><span class="pre">\\s</span></code> = <code class="docutils literal"><span class="pre">[:space:]</span></code>, <code class="docutils literal"><span class="pre">\\S</span></code> = <code class="docutils literal"><span class="pre">^[:space:]</span></code>.</p>
<p>Here are some more examples showing a wide range of string
functionality:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE  TRUE  TRUE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">##      start end</span>
<span class="c">##</span>
<span class="c">## [[2]]</span>
<span class="c">##      start end</span>
<span class="c">## [1,]     9   9</span>
<span class="c">##</span>
<span class="c">## [[3]]</span>
<span class="c">##      start end</span>
<span class="c">## [1,]     5   5</span>
<span class="c">## [2,]    12  12</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## character(0)</span>
<span class="c">##</span>
<span class="c">## [[2]]</span>
<span class="c">## character(0)</span>
<span class="c">##</span>
<span class="c">## [[3]]</span>
<span class="c">## [1] &quot;Juan &quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;John&quot;            &quot;Jennifer pierce&quot;</span>
<span class="c">## [3] &quot;Juan carlos rey&quot;</span>
</pre></div>
</div>
<p><strong>Challenge</strong>: how would we find a spam-like pattern with digits or
non-letters inside a word? E.g., I want to find V1agra or Fancy
<a class="reference external" href="mailto:repl!c&#37;&#52;&#48;ted">repl!c<span>&#64;</span>ted</a> watches.</p>
</div>
<div class="section" id="location-specific-matches">
<h2>Location-specific matches<a class="headerlink" href="#location-specific-matches" title="Permalink to this headline">¶</a></h2>
<p>To find a pattern at the beginning of the string, we use ^ (note this
was also used for negation, but in that case occurs only inside square
brackets) and to find it at the end we use $.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE FALSE  TRUE</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] FALSE FALSE FALSE</span>
</pre></div>
</div>
<p>What does this match: <code class="docutils literal"><span class="pre">^[^[:lower:]]$</span></code> ?</p>
</div>
<div class="section" id="repetitions">
<h2>Repetitions<a class="headerlink" href="#repetitions" title="Permalink to this headline">¶</a></h2>
<p>Now suppose I wanted to be able to detect phone numbers, email
addresses, etc. I often need to be able to deal with repetitions of
character sets.</p>
<p>I can indicate repetitions as indicated in these examples:</p>
<ul class="simple">
<li>[[:digit:]]* – any number of digits (zero or more)</li>
<li>[[:digit:]]+ – at least one digit</li>
<li>[[:digit:]]? – zero or one digits</li>
<li>[[:digit:]]{1,3} – at least one and no more than three digits</li>
<li>[[:digit:]]{2,} – two or more digits</li>
</ul>
<p>An example is that <code class="docutils literal"><span class="pre">\\[.*\\]</span></code> is the pattern of any number of
characters (<em>.*</em>) separated by square brackets.</p>
<p>So a search for US/Canadian/Caribbean phone numbers might become:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## [1] &quot;919-543-3300&quot;</span>
<span class="c">##</span>
<span class="c">## [[2]]</span>
<span class="c">## character(0)</span>
<span class="c">##</span>
<span class="c">## [[3]]</span>
<span class="c">## character(0)</span>
<span class="c">##</span>
<span class="c">## [[4]]</span>
<span class="c">## [1] &quot;919.554.3800&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Challenge</strong>: How would I extract an email address from an arbitrary
text string?</p>
</div>
<div class="section" id="grouping-and-references">
<h2>Grouping and references<a class="headerlink" href="#grouping-and-references" title="Permalink to this headline">¶</a></h2>
<p>We often want to be able to look for multi-character patterns and to be
able to refer back to the patterns that are found. Both are accomplished
with parentheses. For example, the phone number detection problem could
have been done a bit more compactly (and more generally, in case the
area code is omitted or a 1 is included) as:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## [1] &quot;919-543-3300&quot;</span>
<span class="c">##</span>
<span class="c">## [[2]]</span>
<span class="c">## character(0)</span>
<span class="c">##</span>
<span class="c">## [[3]]</span>
<span class="c">## character(0)</span>
<span class="c">##</span>
<span class="c">## [[4]]</span>
<span class="c">## [1] &quot;1.919.554.3800&quot;</span>
<span class="c">##</span>
<span class="c">## [[5]]</span>
<span class="c">## [1] &quot;337.4355&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Parentheses are also used with a pipe (|) to indicate any one of a set
of multi-character sequences, such as <code class="docutils literal"><span class="pre">(http|ftp)</span></code>.</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##      start end</span>
<span class="c">## [1,]    13  19</span>
<span class="c">## [2,]    NA  NA</span>
<span class="c">## [3,]     1   6</span>
</pre></div>
</div>
<p>It’s often helpful to be able to save a pattern as a variable and refer
back to it. Here’s an example that might have been helpful in dealing
with the extra commas in the comma-delimited FEC elections data file in
PS1:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;\&quot;H4NY07011\&quot;,\&quot;ACKERMAN GARY L.\&quot;,\&quot;H\&quot;,\&quot;$13242\&quot;,,,&quot;</span>
</pre></div>
</div>
<p>We can have multiple sets of parentheses, referred to using <code class="docutils literal"><span class="pre">\\1</span></code>,
<code class="docutils literal"><span class="pre">\\2</span></code>, etc.</p>
<p><strong>Challenge</strong>: Suppose a text string has dates in the form “Aug-3”,
“May-9”, etc. and I want them in the form “3 Aug”, “9 May”, etc. How
would I do this search/replace?</p>
</div>
<div class="section" id="greedy-matching">
<h2>Greedy matching<a class="headerlink" href="#greedy-matching" title="Permalink to this headline">¶</a></h2>
<p>It turns out the pattern matching is ’greedy’ - it looks for the longest
match possible.</p>
<p>Suppose we want to strip out html tags as follows:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;Do an internship  course.&quot;</span>
</pre></div>
</div>
<p>What went wrong?</p>
<p>One solution is to append a ? to the repetition syntax to cause the
matching to be non-greedy. Here’s an example.</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [1] &quot;Do an internship  in place  of  one  course.&quot;</span>
</pre></div>
</div>
<p>However, one can often avoid greedy matching by being more clever.</p>
<p><strong>Challenge</strong>: How could we change our regexp to avoid the greedy
matching without using the “?”?</p>
</div>
<div class="section" id="regular-expressions-in-other-contexts">
<h2>Regular expressions in other contexts<a class="headerlink" href="#regular-expressions-in-other-contexts" title="Permalink to this headline">¶</a></h2>
<p>Regular expression can be used in a variety of places. E.g., to split by
any number of white space characters</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## a dog    jumped</span>
<span class="c">## over     the moon.</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## [1] &quot;a&quot;      &quot;dog&quot;    &quot;jumped&quot; &quot;over&quot;   &quot;the&quot;</span>
<span class="c">## [6] &quot;moon.&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [[1]]</span>
<span class="c">## [1] &quot;a&quot;            &quot;dog&quot;          &quot;jumped\nover&quot;</span>
<span class="c">## [4] &quot;the&quot;          &quot;moon.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Table 2 summarizes the key syntax in regular expressions.</p>
<p>|c|&gt;p5in| Syntax &amp; What it matches
<em>^ab</em> &amp; match ’ab’ at the beginning of the string
<em>ab$</em> &amp; match ’ab’ at the end of the string
<em>[abc]</em> &amp; match a or b or c anywhere (this is a character class)
<em>[ \t]</em> &amp; match a space or a tab
<code class="docutils literal"><span class="pre">(ab|cd|def)</span></code> &amp; match any of the strings in the set
<code class="docutils literal"><span class="pre">(ab){2,9}</span></code> &amp; match ’ab’ repeated at least 2 and no more than 9
times
<em>(ab){2,}</em> &amp; match ’ab’ repeated 2 or more times
<em>[0-9a-z]</em> &amp; match a single digit or lower-case alphabetical
<em>[^0-9]</em> &amp; match any single character except a digit
<code class="docutils literal"><span class="pre">a.b</span></code> &amp; match a and b separated by a single character
<em>a.*b</em> &amp; match a and b separated by any number of (or no) characters
<em>a.+b</em> &amp; like a.*b but must have at least one character in between
<em>[[:digit:]]</em> &amp; match <em>digit</em> class; other classes are <em>alpha</em>,
<em>alnum</em>, <em>lower</em>, <em>upper</em>, <em>punct</em>, <em>blank</em>, <em>space</em> (see ?regexp)
<em>\\[</em> &amp; double backslashes are used if we want to search for a
meta-character used in regexp syntax</p>
<div class="section" id="webscraping">
<h3>Webscraping<a class="headerlink" href="#webscraping" title="Permalink to this headline">¶</a></h3>
<p>A couple useful packages for this are <em>RCurl</em> and <em>XML</em>.</p>
<ul class="simple">
<li><em>RCurl</em> allows one to interact with webpages, making HTTP requests,
downloading information, submitting forms, etc.</li>
<li>We’ve already seen the use of the <em>XML</em> package to process HTML in
Unit 3.</li>
</ul>
<table class="docutils footnote" frame="void" id="id44" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id35">[1]</a></td><td>calling it pass by value is actually a simplification of what really
happens, but a useful one, until we discuss copy-on-change, promises,
and lazy evaluation in Unit 6</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RCSDS</a></h1>



<p class="blurb">Fall 2015</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard/index.html">Core Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="append/index.html">Appendices</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://www.jarrodmillman.com/stat159-fall2015/">Course home</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
      &copy;2009-2015, K. Jarrod Millman.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/index.txt"
          rel="nofollow">Page source</a>
        <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
    </div>

  </body>
</html>