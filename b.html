<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Shell basics &mdash; RCSDS 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="RCSDS 0.1 documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>&#64;path/home/jarrod/src/stat243-fall-2014/units//</p>
<p>Note that it can be difficult to distinguish what is shell-specific and
what is just part of UNIX. Some of the material here is not
bash-specific but general to UNIX.</p>
<p>Reference: Newham and Rosenblatt, Learning the bash Shell, 2nd ed.</p>
<div class="section" id="shell-basics">
<h1>Shell basics<a class="headerlink" href="#shell-basics" title="Permalink to this headline">¶</a></h1>
<p>The shell is the interface between you and the UNIX operating system.
When you are working in a terminal window (i.e., a window with the
command line interface), you’re interacting with a shell.</p>
<p>There are multiple shells (<em>sh</em>, <em>bash</em>, <em>csh</em>, <em>tcsh</em>, <em>ksh</em>). We’ll
assume usage of <em>bash</em>, as this is the default for Mac OS X, the BCE VM,
and on the SCF machines and is very common for Linux.</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">What is my default shell?</div>
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">echo</span> <span class="pre">$SHELL</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">To change to bash on a one-time basis:</div>
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">bash</span></code></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">To make it your default:</div>
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">chsh</span> <span class="pre">/bin/bash</span></code></div>
<div class="line"><em>/bin/bash</em> should be whatever the path to the bash shell is, which
you can figure out using <code class="docutils literal"><span class="pre">which</span> <span class="pre">bash</span></code></div>
</div>
</li>
</ol>
<p>Shell commands can be saved in a file (with extension <em>.sh</em>) and this
file can be executed as if it were a program. To run a shell script
called <em>file.sh</em>, you would type <code class="docutils literal"><span class="pre">./file.sh</span></code>. Note that if you just
typed`` file.sh``, the operating system will generally have trouble
finding the script and recognizing that it is executable. To be sure
that the operating system knows what shell to use to interpret the
script, the first line of the script should be <code class="docutils literal"><span class="pre">#!/bin/bash</span></code> (in the
case that you’re using the bash shell). Also, <em>file.sh</em> would need to be
executable (i.e., to have the ’x’ flag set).</p>
</div>
<div class="section" id="tab-completion">
<h1>Tab completion<a class="headerlink" href="#tab-completion" title="Permalink to this headline">¶</a></h1>
<p>When working in the shell, it is often unnecessary to type out an entire
command or file name, because of a feature known as tab completion. When
you are entering a command or filename in the shell, you can, at any
time, hit the tab key, and the shell will try to figure out how to
complete the name of the command or filename you are typing. If there is
only one command in the search path and you’re using tab completion with
the first token of a line, then the shell will display its value and the
cursor will be one space past the completed name. If there are multiple
commands that match the partial name, the shell will display as much as
it can. In this case, hitting tab twice will display a list of choices,
and redisplay the partial command line for further editing. Similar
behavior with regard to filenames occurs when tab completion is used on
anything other than the first token of a command.</p>
<p>Note that R does tab completion for objects (including functions) and
filenames.</p>
</div>
<div class="section" id="command-history">
<h1>Command history<a class="headerlink" href="#command-history" title="Permalink to this headline">¶</a></h1>
<p>By using the up and down arrows, you can scroll through commands that
you have entered previously. So if you want to rerun the same command,
or fix a typo in a command you entered, just scroll up to it and hit
enter to run it or edit the line and then hit enter.</p>
<p>Note that you can use emacs-like control sequences (<code class="docutils literal"><span class="pre">C-a</span></code>, <code class="docutils literal"><span class="pre">C-e</span></code>,
<code class="docutils literal"><span class="pre">C-k</span></code>) to navigate and delete characters, just as you can at the
prompt in the shell usually.</p>
<p>You can also rerun previous commands as follows:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">!-n</span> <span class="pre">#</span> <span class="pre">runs</span> <span class="pre">the</span> <span class="pre">``\</span> <span class="pre">``n</span></code><code class="docutils literal"><span class="pre">th</span> <span class="pre">previous</span> <span class="pre">command</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">!gi</span> <span class="pre">#</span> <span class="pre">runs</span> <span class="pre">the</span> <span class="pre">last</span> <span class="pre">command</span> <span class="pre">that</span> <span class="pre">started</span> <span class="pre">with</span> <span class="pre">’gi’</span></code></p>
<p>If you’re not sure what command you’re going to recall, you can append
<code class="docutils literal"><span class="pre">:p</span></code> at the end of the text you type to do the recall, and the result
will be printed, but not executed. For example:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">!gi:p</span></code></div>
<div class="line">You can then use the up arrow key to bring back that statement for
editing or execution.</div>
</div>
<p>You can also search for commands by doing <code class="docutils literal"><span class="pre">C-r</span></code> and typing a string of
characters to search for in the search history. You can hit return to
submit, <code class="docutils literal"><span class="pre">C-c</span></code> to get out, or <code class="docutils literal"><span class="pre">ESC</span></code> to put the result on the regular
command line for editing.</p>
</div>
<div class="section" id="wildcards-in-filenames">
<h1>Wildcards in filenames<a class="headerlink" href="#wildcards-in-filenames" title="Permalink to this headline">¶</a></h1>
<p>The shell will expand certain special characters to match patterns of
file names, before passing those filenames on to a program. Note that
the programs themselves don’t know anything about wildcards; it is the
shell that does the expansion, so that programs don’t see the wildcards.
Table 1 shows some of the special characters that the shell uses for
expansion:</p>
<p>|c|c| Syntax &amp; What it matches
<code class="docutils literal"><span class="pre">?</span></code> &amp; any single character
<code class="docutils literal"><span class="pre">*</span></code> &amp; zero or more characters
<code class="docutils literal"><span class="pre">[c_{1}c_{2}\ldots]</span></code> &amp; any character in the set
<code class="docutils literal"><span class="pre">[!c_{1}c_{2}\ldots]</span></code> &amp; anything not in the set
<code class="docutils literal"><span class="pre">[c_{1}-c_{2}]</span></code> &amp; anything in the range from <span class="math">\(c_{1}\)</span> to
<span class="math">\(c_{2}\)</span><code class="docutils literal"><span class="pre">{string1,string2,...}</span></code> &amp; anything in the set of strings</p>
<p>Here are some examples of using wildcards:</p>
<ul>
<li><p class="first">List all files ending with a digit:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">ls</span> <span class="pre">*[0-9]</span></code></p>
</li>
<li><p class="first">Make a copy of <em>filename</em> as <em>filename.old</em></p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>&gt; cp filename{,.old} ``</p>
</li>
<li><p class="first">Remove all files beginning with <em>a</em> or <em>z</em>:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">rm</span> <span class="pre">[az]*</span></code></p>
</li>
<li><p class="first">List all the R code files with a variety of suffixes:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">ls</span> <span class="pre">*.{r,q,R}</span></code></p>
</li>
</ul>
<p>The <em>echo</em> command can be used to verify that a wildcard expansion will
do what you think it will:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">echo</span> <span class="pre">cp</span> <span class="pre">filename{,.old}</span> <span class="pre">#</span> <span class="pre">returns</span> <span class="pre">cp</span> <span class="pre">filename</span> <span class="pre">filename.old</span></code></p>
<p>If you want to suppress the special meaning of a wildcard in a shell
command, precede it with a backslash (<strong>*\*</strong>). Note that this is a
general rule of thumb in many similar situations when a character has a
special meaning but you just want to treat it as a character.</p>
</div>
<div class="section" id="basic-unix-utilities">
<h1>Basic UNIX utilities<a class="headerlink" href="#basic-unix-utilities" title="Permalink to this headline">¶</a></h1>
<p>In some of what follows, we’ll use the <em>cpds.csv</em> file in the <em>data</em>
directory of the class repository.</p>
<p>Table 2 shows some basic UNIX programs, which are sometimes referred to
as filters. The general syntax for a UNIX program is</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">command</span> <span class="pre">-options</span> <span class="pre">argument1</span> <span class="pre">argument2</span> <span class="pre">...</span></code></div>
<div class="line">For example, <a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">-i</span> <span class="pre">graphics</span> <span class="pre">file.txt</span></code> <a href="#id7"><span class="problematic" id="id8">**</span></a><a href="#id9"><span class="problematic" id="id10">**</span></a></div>
<div class="line">looks for <em>graphics</em> (argument 1) in <em>file.txt</em> (argument2) with the
option <em>-i</em>, which says to ignore the case of the letters. <a href="#id11"><span class="problematic" id="id12">``</span></a><a href="#id13"><span class="problematic" id="id14">``</span></a></div>
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">less</span> <span class="pre">file.txt</span></code> <a href="#id15"><span class="problematic" id="id16">**</span></a><a href="#id17"><span class="problematic" id="id18">**</span></a></div>
<div class="line">simply pages through a text file (you can navigate up and down) so you
can get a feel for what’s in it.</div>
</div>
<p>|c|c| Name &amp; What it does
<em>tail</em> &amp; shows last few lines of a file
<em>less</em> &amp; shows a file one screen at a time
<em>cat</em> &amp; writes file to screen
<em>wc</em> &amp; counts words and lines in a file
<em>grep</em> &amp; finds patterns in files
<em>wget</em> or <em>curl</em> &amp; download files from the web
<em>sort</em> &amp; sorts a file by line
<em>nl</em> &amp; numbers lines in a file
<em>diff</em> &amp; compares two files
<em>uniq</em> &amp; removes repeated (sequential) rows
<em>cut</em> &amp; extracts fields (columns) from a file</p>
<p>UNIX programs often take options that are identified with a minus
followed by a letter, followed by the specific option (adding a space
before the specific option is fine). Options may also involve two
dashes, e.g., <code class="docutils literal"><span class="pre">R</span> <span class="pre">--no-save</span></code>. Here are some examples using <em>tail</em> :</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">tail</span> <span class="pre">--help</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">tail</span> <span class="pre">-n</span> <span class="pre">10</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">last</span> <span class="pre">10</span> <span class="pre">lines</span> <span class="pre">of</span> <span class="pre">cpds.csv</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">shows</span> <span class="pre">end</span> <span class="pre">of</span> <span class="pre">file,</span> <span class="pre">continually</span> <span class="pre">refreshing</span></code></p>
<p>A few more tidbits about <em>grep</em>:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">^2001</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">returns</span> <span class="pre">lines</span> <span class="pre">that</span> <span class="pre">start</span> <span class="pre">with</span> <span class="pre">’2001’</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">0$</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">returns</span> <span class="pre">lines</span> <span class="pre">that</span> <span class="pre">end</span> <span class="pre">with</span> <span class="pre">’0’</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">19.0</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">returns</span> <span class="pre">lines</span> <span class="pre">with</span> <span class="pre">’19’</span> <span class="pre">separated</span> <span class="pre">from</span> <span class="pre">’0’</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">single</span> <span class="pre">character</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">19.*0</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">now</span> <span class="pre">separated</span> <span class="pre">by</span> <span class="pre">any</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">characters</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">-o</span> <span class="pre">19.0</span> <span class="pre">cpds.csv</span> <span class="pre">#</span> <span class="pre">returns</span> <span class="pre">only</span> <span class="pre">the</span> <span class="pre">content</span> <span class="pre">matching</span> <span class="pre">the</span> <span class="pre">pattern</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">relevant</span> <span class="pre">lines</span></code></p>
<p>Note that the first argument to grep is the pattern you are looking for.
The syntax is different from that used for wildcards in file names.
Also, you can use regular expressions in the pattern. We won’t see this
in detail here, but will see regular expressions in R shortly.</p>
<p>It is sometimes helpful to put the pattern inside double quotes, e.g.,
if you want spaces in your pattern, e.g.,</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">George</span> <span class="pre">.*</span> <span class="pre">Bush</span> <span class="pre">cpds.csv</span></code></p>
<p>More generally in UNIX, enclosing a string in quotes is often useful to
indicate that it is a single argument/value.</p>
<p>If you want to explicitly look for one of the special characters used in
creating patterns (such as double quote (``), period (.), etc., you
can “escape” them by preceding with a back-slash. For example to look
for <em>“Canada”</em>, including the quotes.</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">\Canada\.</span> <span class="pre">cpds.csv</span></code></p>
<p>If you have a big data file and need to subset it by line (e.g., with
<em>grep</em>) or by field (e.g., with <em>cut</em>), then you can do it really fast
from the UNIX command line, rather than reading it with R, SAS, Python,
etc.</p>
<p>Much of the power of these utilities comes in piping between them (see
Section 6) and using wildcards (see Section 4) to operate on groups of
files. The utilities can also be used in shell scripts to do more
complicated things.</p>
</div>
<div class="section" id="redirection">
<h1>Redirection<a class="headerlink" href="#redirection" title="Permalink to this headline">¶</a></h1>
<p>UNIX programs that involve input and/or output often operate by reading
input from a stream known as standard input (<em>stdin</em>), and writing their
results to a stream known as standard output (<em>stdout</em>). In addition, a
third stream known as standard error (<em>stderr</em>) receives error messages,
and other information that’s not part of the program’s results. In the
usual interactive session, standard output and standard error default to
your screen, and standard input defaults to your keyboard. You can
change the place from which programs read and write through redirection.
The shell provides this service, not the individual programs, so
redirection will work for all programs. Table 3 shows some examples of
redirection.</p>
<p>|c|c| Syntax &amp; What it does
<code class="docutils literal"><span class="pre">cmd</span> <span class="pre">&gt;</span> <span class="pre">file</span></code> &amp; sends stdout from <em>cmd</em> into <em>file</em>, overwriting
<em>file</em><code class="docutils literal"><span class="pre">cmd</span> <span class="pre">&gt;&gt;</span> <span class="pre">file</span></code> &amp; appends stdout from <em>cmd</em> to <em>file</em><code class="docutils literal"><span class="pre">cmd</span> <span class="pre">&lt;</span> <span class="pre">file</span></code> &amp; execute <em>cmd</em> reading stdin from <em>file</em><code class="docutils literal"><span class="pre">cmd</span> <span class="pre">&lt;infile</span> <span class="pre">&gt;outfile</span> <span class="pre">2&gt;errors</span></code> &amp; reads from <em>infile</em>, sending
stdout to <em>outfile</em> and stderr to <em>errors</em><code class="docutils literal"><span class="pre">cmd</span> <span class="pre">&lt;infile</span> <span class="pre">&gt;outfile</span> <span class="pre">2&gt;&amp;1</span></code> &amp; reads from <em>infile</em>, sending stdout
and stderr to <em>outfile</em><code class="docutils literal"><span class="pre">cmd1</span> <span class="pre">|</span> <span class="pre">cmd2</span></code> &amp; sends stdout from <em>cmd1</em> as stdin to <em>cmd2</em> (a pipe)</p>
<p>Note that <em>cmd</em> may include options and arguments as seen in the
previous section.</p>
<p>Operations where output from one command is used as input to another
command (via the | operator) are known as pipes; they are made
especially useful by the convention that many UNIX commands will accept
their input through the standard input stream when no file name is
provided to them.</p>
<p>Here’s an example of finding out how many unique entries there are in
the 2rd column of a data file whose fields are separated by commas:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">cut</span> <span class="pre">-d’,’</span> <span class="pre">-f2</span> <span class="pre">cpds.csv</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">|</span> <span class="pre">wc</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">cut</span> <span class="pre">-d’,’</span> <span class="pre">-f2</span> <span class="pre">cpds.csv</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">&gt;</span> <span class="pre">countries.txt</span></code></p>
<p>To see if there are any “S” values in certain fields (fixed width) of a
set of files (note I did this on 22,000 files (5 Gb or so) in about 5
minutes on my desktop; it would have taken much more time to read the
data into R):</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">cut</span> <span class="pre">-b29,37,45,53,61,69,77,85,93,101,109,117,125,133,141,149,</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">157,165,173,181,189,197,205,213,221,229,237,245,253,261,269</span> <span class="pre">USC*.dly</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">S</span> <span class="pre">|</span> <span class="pre">less</span></code></div>
</div>
<p>A closely related, but subtly different, capability is offered by the
use of backticks (`). When the shell encounters a command surrounded by
backticks, it runs the command and replaces the backticked expression
with the output from the command; this allows something similar to a
pipe, but is appropriate when a command reads its arguments directly
from the command line instead of through standard input. For example,
suppose we are interested in searching for the text <em>pdf</em> in the last 4
R code files (those with suffix <em>.</em>r or .R) that were modified in the
current directory. We can find the names of the last 4 files ending in
“.R” or “.r” which were modified using</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">ls</span> <span class="pre">-t</span> <span class="pre">*.{R,r}</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-4</span></code></div>
<div class="line">and we can search for the required pattern using <em>grep</em>. Putting these
together with the backtick operator we can solve the problem using</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">pdf</span> <span class="pre">`ls</span> <span class="pre">-t</span> <span class="pre">*.{R,r}</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-4`</span></code></div>
<div class="line">Note that piping the output of the <em>ls</em> command into <em>grep</em> would not
achieve the desired goal, since <em>grep</em> reads its filenames from the
command line, not standard input.</div>
</div>
<p>You can also redirect output as the arguments to another program using
the <em>xargs</em> utility. Here’s an example:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">ls</span> <span class="pre">-t</span> <span class="pre">*.{R,r}</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-4</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">grep</span> <span class="pre">pdf</span></code></p>
<p>And you can redirect output into a shell variable (see section 9) using
backticks in a similar manner to that done above:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">files=ls</span> <span class="pre">-t</span> <span class="pre">*.{R,r}</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-4</span> <span class="pre">#</span> <span class="pre">NOTE</span> <span class="pre">-</span> <span class="pre">don’t</span> <span class="pre">put</span> <span class="pre">any</span> <span class="pre">spaces</span> <span class="pre">around</span> <span class="pre">the</span> <span class="pre">=</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">echo</span> <span class="pre">$files</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">grep</span> <span class="pre">pdf</span> <span class="pre">$files</span></code></p>
</div>
<div class="section" id="job-control">
<h1>Job Control<a class="headerlink" href="#job-control" title="Permalink to this headline">¶</a></h1>
<div class="section" id="starting-a-job">
<h2>Starting a job<a class="headerlink" href="#starting-a-job" title="Permalink to this headline">¶</a></h2>
<p>When you run a command in a shell by simply typing its name, you are
said to be running in the foreground. When a job is running in the
foreground, you can’t type additional commands into that shell session,
but there are two signals that can be sent to the running job through
the keyboard. To interrupt a program running in the foreground, use
<code class="docutils literal"><span class="pre">C-c</span></code>; to quit a program, use <code class="docutils literal"><span class="pre">C-\</span></code>. While modern windowed systems
have lessened the inconvenience of tying up a shell with foreground
processes, there are some situations where running in the foreground is
not adequate.</p>
<p>The primary need for an alternative to foreground processing arises when
you wish to have jobs continue to run after you log off the computer. In
cases like this you can run a program in the background by simply
terminating the command with an ampersand (<em>&amp;</em>). However, before putting
a job in the background, you should consider how you will access its
results, since <em>stdout</em> is not preserved when you log off from the
computer. Thus, redirection (including redirection of <em>stderr</em>) is
essential when running jobs in the background. As a simple example,
suppose that you wish to run an R script, and you don’t want it to
terminate when you log off. (Note that this can also be done using
<code class="docutils literal"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">BATCH</span></code>, so this is primarily an illustration.)</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">R</span> <span class="pre">--no-save</span> <span class="pre">&lt;</span> <span class="pre">code.R</span> <span class="pre">&gt;</span> <span class="pre">code.Rout</span> <span class="pre">2&gt;&amp;1</span> <span class="pre">&amp;</span></code></div>
<div class="line">If you forget to put a job in the background when you first execute
it, you can do it while it’s running in the foreground in two steps.
First, suspend the job using the <code class="docutils literal"><span class="pre">C-z</span></code> signal. After receiving the
signal, the program will interrupt execution, but will still have
access to all files and other resources. Next, issue the <code class="docutils literal"><span class="pre">bg</span></code>
command, which will put the stopped job in the background.</div>
</div>
</div>
<div class="section" id="listing-and-killing-jobs">
<h2>Listing and killing jobs<a class="headerlink" href="#listing-and-killing-jobs" title="Permalink to this headline">¶</a></h2>
<p>Since only foreground jobs will accept signals through the keyboard, if
you want to terminate a background job you must first determine the
unique process id (PID) for the process you wish to terminate through
the use of the <em>ps</em> command. For example, to see all the jobs running on
a particular computer, you could use a command like:</p>
<div class="line-block">
<div class="line"><a href="#id19"><span class="problematic" id="id20">``</span></a>&gt; ps -aux ``</div>
<div class="line">Among the output after the header (shown here) might appear a line
that looks like this: <a href="#id21"><span class="problematic" id="id22">``</span></a><a href="#id23"><span class="problematic" id="id24">``</span></a></div>
<div class="line"><a href="#id25"><span class="problematic" id="id26">``</span></a>USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND ``</div>
<div class="line"><a href="#id27"><span class="problematic" id="id28">``</span></a>paciorek 11998 97.0 39.1 1416644 1204824 pts/16 R+ Jul27 1330:01 ``</div>
<div class="line"><a href="#id29"><span class="problematic" id="id30">``</span></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/usr/lib64/R/bin/exec/R ``</div>
<div class="line">In this example, the <em>ps</em> output tells us that this R job has a PID of
<em>11998</em>, that it has been running for 1330 minutes (!), is using 97%
of CPU and 39% of memory, and that it started on July 27. You could
then issue the command:</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">kill</span> <span class="pre">11998</span></code></div>
<div class="line">or, if that doesn’t work</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">kill</span> <span class="pre">-9</span> <span class="pre">11998</span></code></div>
<div class="line">to terminate the job. Another useful command in this regard is
<em>killall</em>, which accepts a program name instead of a process id, and
will kill all instances of the named program. E.g.,</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">killall</span> <span class="pre">R</span></code></div>
<div class="line">Of course, it will only kill the jobs that belong to you, so it will
not affect the jobs of other users. Note that the <em>ps</em> and <em>kill</em>
commands only apply to the particular computer on which they are
executed, not to the entire computer network. Thus, if you start a job
on one machine, you must log back into that same machine in order to
manage your job.</div>
</div>
</div>
<div class="section" id="monitoring-jobs-and-memory-use">
<h2>Monitoring jobs and memory use<a class="headerlink" href="#monitoring-jobs-and-memory-use" title="Permalink to this headline">¶</a></h2>
<p>The <em>top</em> command also allows you to monitor the jobs on the system and
in real-time. In particular, it’s useful for seeing how much of the CPU
and how much memory is being used, as well as figuring out a PID as an
alternative to <em>ps</em>. You can also renice jobs (see below) and kill jobs
from within top: just type <em>r</em> <strong>**</strong> or <em>k</em>, respectively, and proceed
from there.</p>
<p>One of the main things to watch out for is a job that is using close to
100% of memory and much less than 100% of CPU. What is generally
happening is that your program has run out of memory and is using
virtual memory on disk, spending most of its time writing to/from disk,
sometimes called <em>paging</em> or <em>swapping</em>. If this happens, it can be a
very long time, if ever, before your job finishes.</p>
</div>
<div class="section" id="nicing-a-job">
<h2>Nicing a job<a class="headerlink" href="#nicing-a-job" title="Permalink to this headline">¶</a></h2>
<p>The most important thing to remember when starting a job on a machine
that is not your personal machine is how to be a good citizen. This
often involves ’nicing’ your jobs. This is required on the SCF machines,
but the compute servers should automatically nice your jobs. Nicing a
job puts it at a lower priority so that a user working at the keyboard
has higher priority in using the CPU. Here’s how to do it, giving the
job a low priority of 19, as required by SCF:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">nice</span> <span class="pre">-19</span> <span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">BATCH</span> <span class="pre">--no-save</span> <span class="pre">code.R</span> <span class="pre">code.Rout</span> <span class="pre">&amp;</span></code></div>
<div class="line">If you forget and just submit the job without nicing, you can reduce
the priority by doing:</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">renice</span> <span class="pre">+19</span> <span class="pre">11998</span></code></div>
<div class="line">where <em>11998</em> is the PID of your job.</div>
</div>
<p>On many larger UNIX cluster computers, all jobs are submitted via a job
scheduler and enter a queue, which handles the issue of prioritization
and jobs conflicting. Syntax varies by system and queueing software, but
may look something like this for submitting an R job:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">bsub</span> <span class="pre">-q</span> <span class="pre">long</span> <span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">BATCH</span> <span class="pre">--no-save</span> <span class="pre">code.R</span> <span class="pre">code.Rout</span> <span class="pre">#</span> <span class="pre">just</span> <span class="pre">an</span> <span class="pre">example;</span> <span class="pre">this</span> <span class="pre">will</span> <span class="pre">not</span> <span class="pre">work</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">SCF</span> <span class="pre">network</span></code></p>
</div>
</div>
<div class="section" id="aliases">
<h1>Aliases<a class="headerlink" href="#aliases" title="Permalink to this headline">¶</a></h1>
<p>Aliases allow you to use an abbreviation for a command, to create new
functionality or to insure that certain options are always used when you
call an existing command. For example, I’m lazy and would rather type
<code class="docutils literal"><span class="pre">q</span></code> instead of <code class="docutils literal"><span class="pre">exit</span></code> to terminate a shell window. You could create
the alias as follow</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">alias</span> <span class="pre">q=exit</span></code></div>
<div class="line">As another example, suppose you find the <em>-F</em> option of <em>ls</em> (which
displays <strong>*/*</strong> after directories, <strong>***</strong> after executable files
and <strong>*&#64;*</strong> after links) to be very useful. The command</div>
</div>
<div class="line-block">
<div class="line"><a href="#id31"><span class="problematic" id="id32">``</span></a>&gt; alias ls=ls -F ``</div>
<div class="line">will insure that the <em>-F</em> option will be used whenever you use <em>ls</em>.
If you need to use the unaliased version of something for which you’ve
created an alias, precede the name with a backslash (<strong>*\*</strong>). For
example, to use the normal version of <em>ls</em> after you’ve created the
alias described above, just type</div>
</div>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">\ls</span></code></p>
<p>The real power of aliases is only achieved when they are automatically
set up whenever you log in to the computer or open a new shell window.
To achieve that goal with aliases (or any other bash shell commands),
simply insert the commands in the file <em>.bashrc</em> in your home directory.
See the <em>example.bashrc</em> file in the repository for some of what’s in my
<em>.bashrc</em> file.</p>
</div>
<div class="section" id="shell-variables">
<h1>Shell Variables<a class="headerlink" href="#shell-variables" title="Permalink to this headline">¶</a></h1>
<p>We can define shell variables that will help us when writing shell
scripts. Here’s an example of defining a variable:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">myDir=~/stat243-fall-2014/units</span></code></div>
<div class="line">The shell may not like it if you leave any spaces around the = sign.
To see the value of a variable we need to precede it by <em>$</em>:</div>
</div>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">echo</span> <span class="pre">$myDir</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">cd</span> <span class="pre">$myDir</span></code></p>
<p>You can also enclose the variable name in curly brackets, which comes in
handy when we’re embedding a variable within a line of code to make sure
the shell knows where the variable name ends:</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">echo</span> <span class="pre">${myDir}</span></code></p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">touch</span> <span class="pre">${myDir}/tmp.txt</span></code></p>
<p>There are also special shell variables called environment variables that
help to control the shell’s behavior. These are generally named in all
caps. Type <code class="docutils literal"><span class="pre">env</span></code> <a href="#id33"><span class="problematic" id="id34">**</span></a>** to see them. You can create your own environment
variable as follows:</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">export</span> <span class="pre">myDir=~/stat243-fall-2014/units</span></code></div>
<div class="line">The <em>export</em> command ensures that other shells created by the current
shell (for example, to run a program) will inherit the variable.
Without the export command, any shell variables that are set will only
be modified within the current shell. More generally, if one wants a
variable to always be accessible, one would include the definition of
the variable with an <em>export</em> command in your <em>.bashrc</em> file.</div>
</div>
<p>Here’s an example of an environment variable that controls what your
prompt looks like. We can modify it so that it puts the username,
hostname, and pwd in your prompt. This is handy so you know what machine
you’re on and where in the filesystem you are. [Note that on the VM, PS1
is already set in a very similar manner.]</p>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">echo</span> <span class="pre">$PS1</span></code></p>
<div class="line-block">
<div class="line"><a href="#id35"><span class="problematic" id="id36">``</span></a>&gt; export <a class="reference external" href="mailto:PS1=u&#37;&#52;&#48;h">PS1=u<span>&#64;</span>h</a>:w&gt; ``</div>
<div class="line">For me, this is one of the most important things to put in my
<em>.bashrc</em> file. The <strong>\</strong> syntax tells bash what to put in the prompt
string: <em>u</em> for username, <em>h</em> for hostname, and <em>w</em> for working
directory.</div>
</div>
<p>Finally, a note about using single vs. double quotes in shell code. In
general, variables inside double quotes will be evaluated, but variables
not inside double quotes will not be:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## My name is chris</span>
<span class="c">## My name is $name</span>
<span class="c">## He said, &quot;My name is chris.&quot;</span>
</pre></div>
</div>
<p>So we’ll generally use double quotes. We can always work with a literal
double quote by escaping it as seen above.</p>
</div>
<div class="section" id="functions">
<h1>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h1>
<p>You can define your own utilities by creating a shell function. This
allows you to automate things that are more complicated than you can do
with an alias. One nice thing about shell functions is that the shell
automatically takes care of function arguments for you. It places the
arguments given by the user into local variables in the function called
(in order): <em>$1 $2 $3</em> etc. It also fills <em>$#</em> with the number of
arguments given by the user. Here’s an example of using arguments in a
function that saves me some typing when I want to copy a file to the SCF
filesystem:</p>
<p><code class="docutils literal"><span class="pre">function</span> <span class="pre">putscf()</span> <span class="pre">{</span></code></p>
<p><a href="#id37"><span class="problematic" id="id38">``</span></a>&nbsp;&nbsp;&nbsp;scp $1 <a class="reference external" href="mailto:paciorek&#37;&#52;&#48;radagast&#46;berkeley&#46;edu">paciorek<span>&#64;</span>radagast<span>&#46;</span>berkeley<span>&#46;</span>edu</a>:~/$2 ``</p>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">}</span></code></div>
<div class="line">To use this function, I just do the following to copy <em>unit1.pdf</em> from
the current directory on whatever non-SCF machine I’m on to the
directory <em>~/teaching/243</em> on SCF:</div>
</div>
<p><code class="docutils literal"><span class="pre">&gt;</span> <span class="pre">putscf</span> <span class="pre">unit1-unix.pdf</span> <span class="pre">Desktop/.</span></code></p>
<p>Of course you’d want to put such functions in your <em>.bashrc</em> file.</p>
</div>
<div class="section" id="if-then-else">
<h1>If/then/else<a class="headerlink" href="#if-then-else" title="Permalink to this headline">¶</a></h1>
<p>We can use if-then-else type syntax to control the flow of a shell
script. For an example, see <em>niceR()</em> in the demo code file <em>niceR.sh</em>
for this unit.</p>
<p>For more details, look in Newham&amp;Rosenblatt or search online.</p>
</div>
<div class="section" id="for-loops">
<h1>For loops<a class="headerlink" href="#for-loops" title="Permalink to this headline">¶</a></h1>
<p><em>for</em> loops in shell scripting are primarily designed for iterating
through a set of files or directories. Here’s an example:</p>
<p><code class="docutils literal"><span class="pre">for</span> <span class="pre">file</span> <span class="pre">in</span> <span class="pre">$(ls</span> <span class="pre">*.txt)</span></code></p>
<p><code class="docutils literal"><span class="pre">do</span></code></p>
<p><a href="#id39"><span class="problematic" id="id40">``</span></a>&nbsp;&nbsp;&nbsp;mv $file ${file/.txt/.R} ``</p>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;#</span> <span class="pre">this</span> <span class="pre">syntax</span> <span class="pre">replaces</span> <span class="pre">.txt</span> <span class="pre">with</span> <span class="pre">.R</span> <span class="pre">in</span> <span class="pre">$file</span></code></p>
<p><code class="docutils literal"><span class="pre">done</span></code></p>
<p>You could also have done that with <code class="docutils literal"><span class="pre">for</span> <span class="pre">file</span> <span class="pre">in</span> <span class="pre">`ls</span> <span class="pre">*.txt`</span></code></p>
<p>Another use of <em>for</em> loops is automating file downloads: see the demo
code file. And, in my experience, <em>for</em> loops are very useful for
starting a series of jobs: see the demo code files in the repository:
<em>forloopDownload.sh</em> and <em>forloopJobs.sh</em>.</p>
</div>
<div class="section" id="how-much-shell-scripting-should-i-learn">
<h1>How much shell scripting should I learn?<a class="headerlink" href="#how-much-shell-scripting-should-i-learn" title="Permalink to this headline">¶</a></h1>
<p>You can do a fair amount of what you need from within R using the
<em>system()</em> function. This will enable you to avoid dealing with a lot of
shell programming syntax (but you’ll still need to know how to use UNIX
utilities, wildcards, and pipes to be effective). Example: a fellow
student when I was in grad school programmed a tool in R to extract
concert information from the web for bands appearing in her iTunes
library. Not the most elegant solution, but it got the job done.</p>
<p>For more extensive shell programming, it’s probably worth learning
Python and doing it there rather than using a shell script. In
particular iPython makes it very easy to interact with the operating
system.</p>
</div>
<div class="section" id="version-control">
<h1>Version Control<a class="headerlink" href="#version-control" title="Permalink to this headline">¶</a></h1>
<p>Note: Jarrod will cover the material on version control during Section.</p>
<p>At a basic level, a simple principle is to have version numbers for all
your work: code, datasets, manuscripts. Whenever you make a change to a
dataset, increment the version number. For code and manuscripts,
increment when you make substantial changes or have obvious breakpoints
in your workflow.</p>
<p>The basic idea of version control software (VCS) is that instead of
manually trying to keep track of what changes you’ve made to code, data,
and documents, you use software to help you manage the process. This has
several benefits:</p>
<ul class="simple">
<li>easily allowing you to go back to earlier versions</li>
<li>allowing you to have multiple version you can switch between</li>
<li>allowing you to share work easily without worrying about conflicts</li>
<li>providing built-in backup</li>
</ul>
<p>The material that follows is borrowed from Jarrod Millman and Fernando
Perez.</p>
<ol class="arabic simple">
<li>The demo should work if you just run the demo code ’manually’ on your
machine. However, when compiled via knitr from the Lyx/Latex
document, some of the later output in the branching section seems to
be out of sync. So the output in this PDF is not quite right in a few
places.</li>
<li>Also, note that the output from the embedded bash code chunks below
is a bit annoying in that all the output appears in a group after all
of the code lines rather than the output appearing after the
individual line of code. This is some sort of issue with how knitr
processes bash code chunks.</li>
</ol>
<p>There are a number of version control systems (VCS) including CVS and
subversion, which use client-server models. Git is a distributed version
control system. VCS store your material in a <em>repository</em>.</p>
<p>The next couple figures show graphical representations of how a
repository is structured.</p>
<p>Recall that we have been using Git in a very simple fashion. We’ve
cloned my class repository onto our local machines and have updated
materials from that repository.</p>
<p>The goal of this section is to learn how to do more with Git to actually
manage a project of your own.</p>
<p>Hashing provides a way to have a fixed-length identifier for a given set
of information, such as a file or set of files. The identifier is not
guaranteed to be unique, but if the number of items is small, it will
almost always be unique.</p>
<p>A toy implementation</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Hash: 32cff5042299244c8c248f6804bb9756912e5492</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;&nbsp;&nbsp;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&nbsp;</span></code></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Hash: 43925778805d33de28aba5697a967f04613f9153</span>
</pre></div>
</div>
<p>We’ll see that Git uses hashes as identifiers for different versions of
your work.</p>
<p>Simply type <code class="docutils literal"><span class="pre">git</span></code> (or <code class="docutils literal"><span class="pre">git</span> <span class="pre">help</span></code>) to see a full list of all the
’core’ commands. We’ll now go through most of these via small practical
exercises:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## usage: git [--version] [--help] [-C &lt;path&gt;] [-c name=value]</span>
<span class="c">##            [--exec-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]</span>
<span class="c">##            [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]</span>
<span class="c">##            [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]</span>
<span class="c">##            &lt;command&gt; [&lt;args&gt;]</span>
<span class="c">##</span>
<span class="c">## The most commonly used git commands are:</span>
<span class="c">##    add        Add file contents to the index</span>
<span class="c">##    bisect     Find by binary search the change that introduced a bug</span>
<span class="c">##    branch     List, create, or delete branches</span>
<span class="c">##    checkout   Checkout a branch or paths to the working tree</span>
<span class="c">##    clone      Clone a repository into a new directory</span>
<span class="c">##    commit     Record changes to the repository</span>
<span class="c">##    diff       Show changes between commits, commit and working tree, etc</span>
<span class="c">##    fetch      Download objects and refs from another repository</span>
<span class="c">##    grep       Print lines matching a pattern</span>
<span class="c">##    init       Create an empty Git repository or reinitialize an existing one</span>
<span class="c">##    log        Show commit logs</span>
<span class="c">##    merge      Join two or more development histories together</span>
<span class="c">##    mv         Move or rename a file, a directory, or a symlink</span>
<span class="c">##    pull       Fetch from and integrate with another repository or a local branch</span>
<span class="c">##    push       Update remote refs along with associated objects</span>
<span class="c">##    rebase     Forward-port local commits to the updated upstream head</span>
<span class="c">##    reset      Reset current HEAD to the specified state</span>
<span class="c">##    rm         Remove files from the working tree and from the index</span>
<span class="c">##    show       Show various types of objects</span>
<span class="c">##    status     Show the working tree status</span>
<span class="c">##    tag        Create, list, delete or verify a tag object signed with GPG</span>
<span class="c">##</span>
<span class="c">## &#39;git help -a&#39; and &#39;git help -g&#39; list available subcommands and some</span>
<span class="c">## concept guides. See &#39;git help &lt;command&gt;&#39; or &#39;git help &lt;concept&gt;&#39;</span>
<span class="c">## to read about a specific subcommand or concept.</span>
</pre></div>
</div>
<p>We use <em>git init</em> to create an empty repository</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Initialized empty Git repository in /tmp/git-demo/.git/</span>
</pre></div>
</div>
<p>Let’s look at what git did:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## total 0</span>
<span class="c">## drwxrwxr-x.  3 jarrod jarrod  60 Aug 13 09:44 .</span>
<span class="c">## drwxrwxrwt. 16 root   root   460 Aug 13 09:44 ..</span>
<span class="c">## drwxrwxr-x.  7 jarrod jarrod 200 Aug 13 09:44 .git</span>
<span class="c">## total 12</span>
<span class="c">## drwxrwxr-x. 7 jarrod jarrod 200 Aug 13 09:44 .</span>
<span class="c">## drwxrwxr-x. 3 jarrod jarrod  60 Aug 13 09:44 ..</span>
<span class="c">## drwxrwxr-x. 2 jarrod jarrod  40 Aug 13 09:44 branches</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  92 Aug 13 09:44 config</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  73 Aug 13 09:44 description</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  23 Aug 13 09:44 HEAD</span>
<span class="c">## drwxrwxr-x. 2 jarrod jarrod 220 Aug 13 09:44 hooks</span>
<span class="c">## drwxrwxr-x. 2 jarrod jarrod  60 Aug 13 09:44 info</span>
<span class="c">## drwxrwxr-x. 4 jarrod jarrod  80 Aug 13 09:44 objects</span>
<span class="c">## drwxrwxr-x. 4 jarrod jarrod  80 Aug 13 09:44 refs</span>
</pre></div>
</div>
<p>Now let’s edit our first file in the test directory with a text
editor... I’m doing it programatically here for automation purposes, but
you’d normally be editing by hand</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Now we can tell git about this new file using the <em>add</em> command:</p>
<p>We can now ask git about what happened with <em>status</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## On branch master</span>
<span class="c">##</span>
<span class="c">## Initial commit</span>
<span class="c">##</span>
<span class="c">## Changes to be committed:</span>
<span class="c">##   (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span>
<span class="c">##</span>
<span class="c">##  new file:   file1.txt</span>
</pre></div>
</div>
<p>We now permanently record our changes in git’s database.</p>
<p>For now, we are always going to call <em>git commit</em> either with the `-a‘
option or with specific filenames (<code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">file1</span> <span class="pre">file2...</span></code>). This
avoids discussion of an aspect of git called the <em>index</em> (often referred
to also as the ’staging area’). Most everyday work in regular scientific
practice doesn’t require understanding the extra moving parts that the
index involves, so we’ll bypass it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master (root-commit) 47c1412] This is our first commit</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
<span class="c">##  create mode 100644 file1.txt</span>
<span class="c">## On branch master</span>
<span class="c">## nothing to commit, working directory clean</span>
</pre></div>
</div>
<p>In the commit above, we used the `-m‘ flag to specify a message at the
command line. If we don’t do that, git will open the editor we specified
in our configuration above and require that we enter a message. By
default, git refuses to record changes that don’t have a message to go
along with them (though you can obviously ’cheat’ by using an empty or
meaningless string).</p>
<p>We can use git log to see what has been committed to the repository so
far:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## commit 47c1412fc9f958cb0991d998617a77cbd30f04d2</span>
<span class="c">## Author: Jarrod Millman &lt;jarrod.millman@gmail.com&gt;</span>
<span class="c">## Date:   Thu Aug 13 09:44:43 2015 -0700</span>
<span class="c">##</span>
<span class="c">##     This is our first commit</span>
</pre></div>
</div>
<p>Let’s do a little bit more work... Again, in practice you’ll be editing
the files by hand, here we do it via shell commands for the sake of
automation (and therefore the reproducibility of this tutorial!)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>And now we can ask git what is different:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## diff --git a/file1.txt b/file1.txt</span>
<span class="c">## index ce645c7..4baa979 100644</span>
<span class="c">## --- a/file1.txt</span>
<span class="c">## +++ b/file1.txt</span>
<span class="c">## @@ -1 +1,2 @@</span>
<span class="c">##  My first bit of text</span>
<span class="c">## +And now some more text...</span>
</pre></div>
</div>
<p>So the cycle of work in a git context is: work, commit, work, commit,
...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master 27fb906] I have made great progress on this critical matter.</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
</pre></div>
</div>
<p>Now let’s see what the log shows us now:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## commit 27fb906a4575ee9800245217104ed09b00790d12</span>
<span class="c">## Author: Jarrod Millman &lt;jarrod.millman@gmail.com&gt;</span>
<span class="c">## Date:   Thu Aug 13 09:44:44 2015 -0700</span>
<span class="c">##</span>
<span class="c">##     I have made great progress on this critical matter.</span>
<span class="c">##</span>
<span class="c">## commit 47c1412fc9f958cb0991d998617a77cbd30f04d2</span>
<span class="c">## Author: Jarrod Millman &lt;jarrod.millman@gmail.com&gt;</span>
<span class="c">## Date:   Thu Aug 13 09:44:43 2015 -0700</span>
<span class="c">##</span>
<span class="c">##     This is our first commit</span>
</pre></div>
</div>
<p>Sometimes it’s handy to see a very summarized version of the log:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
</pre></div>
</div>
<p>Git supports <em>aliases</em>, new names given to command combinations. Let’s
make this handy shortlog an alias, so we only have to type <code class="docutils literal"><span class="pre">git</span> <span class="pre">slog</span></code>
and see this compact log:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
</pre></div>
</div>
<p>Once a file is added to a repository, we need to use git commands to
rename and remove files. In familiar Unix fashion, the <em>mv</em> and <em>rm</em> git
commands do precisely this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## On branch master</span>
<span class="c">## Changes to be committed:</span>
<span class="c">##   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="c">##</span>
<span class="c">##  renamed:    file1.txt -&gt; file-newname.txt</span>
</pre></div>
</div>
<p>Note that these changes must be committed too, to become permanent! In
git’s world, until something hasn’t been committed, it isn’t permanently
recorded anywhere.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master ef36523] I like this new name better</span>
<span class="c">##  1 file changed, 0 insertions(+), 0 deletions(-)</span>
<span class="c">##  rename file1.txt =&gt; file-newname.txt (100%)</span>
<span class="c">## * ef36523 I like this new name better</span>
<span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
</pre></div>
</div>
<p>Let’s see <em>git rm</em> in action. First a little setup.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master 9226ad5] added test file</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
<span class="c">##  create mode 100644 test.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 6 Aug 13 09:44 test.txt</span>
</pre></div>
</div>
<p>Now let’s do the removal.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## rm &#39;test.txt&#39;</span>
<span class="c">## ls: cannot access test*: No such file or directory</span>
<span class="c">## On branch master</span>
<span class="c">## Changes to be committed:</span>
<span class="c">##   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="c">##</span>
<span class="c">##  deleted:    test.txt</span>
<span class="c">##</span>
<span class="c">## [master 6040d62] removed test file</span>
<span class="c">##  1 file changed, 1 deletion(-)</span>
<span class="c">##  delete mode 100644 test.txt</span>
<span class="c">## On branch master</span>
<span class="c">## nothing to commit, working directory clean</span>
</pre></div>
</div>
<p>Be careful: <em>git rm</em> removes the file from the local filesystem as well
as the repository. If we want to remove a file from the repository but
keep it on the local disk, we can do: <code class="docutils literal"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">--cached</span> <span class="pre">file</span></code></p>
<p>If we want to make a change before we do a commit, we can do that as
follows.</p>
<p>First, let’s remove a file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master 0cdbf65] added test file</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
<span class="c">##  create mode 100644 test.txt</span>
<span class="c">## rm &#39;test.txt&#39;</span>
<span class="c">## On branch master</span>
<span class="c">## Changes to be committed:</span>
<span class="c">##   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="c">##</span>
<span class="c">##  deleted:    test.txt</span>
</pre></div>
</div>
<p>Now suppose I realize I don’t want to remove <em>test.txt</em>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Unstaged changes after reset:</span>
<span class="c">## D    test.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 6 Aug 13 09:44 test.txt</span>
<span class="c">## On branch master</span>
<span class="c">## nothing to commit, working directory clean</span>
</pre></div>
</div>
<p>Note that if you want to unstage an addition before you’ve committed it,
you can do <code class="docutils literal"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--</span> <span class="pre">&lt;file&gt;</span></code>. If you want to remove a file from
the repository but not the filesystem after you’ve committed the
addition of the file, you can do <code class="docutils literal"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">--cached</span></code> and then a commit.</p>
<p>If you have a bunch of files that have been removed or changed (but not
committed) and you want to reset for all of them, you can do:
<code class="docutils literal"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span> <span class="pre">HEAD</span></code>, which should remove working directory changes
and changes changed through git, e.g. <em>git add</em> and <em>git rm</em> changes.</p>
<p>Understanding the difference between the working directory, the index,
and HEAD can be confusing and something I’m still wrapping my head
around. Fig. 3 helps.</p>
<p>The <em>working directory</em> or <em>working tree</em> is the state of your local
directory on the filesystem. The staging area (or <em>index</em>) reflects your
<em>git add</em>, <em>git rm</em>, etc. changes that have been staged but not
committed. The repository reflects your commits. HEAD is the last commit
on the current branch. In our <em>git reset</em> and <em>git checkout</em> operations
above, we had to use <em>git reset</em> to restore the file in the index from
HEAD (from the commit). We then had to use <em>git checkout</em> to check the
file back into the working directory (i.e, have the index and the
working directory match).</p>
<p>What is a branch? It’s a label for the ’current’ commit in a sequence of
ongoing commits.</p>
<p>There can be multiple branches alive at any point in time; the working
directory is the state of a special pointer called HEAD.</p>
<p>Let’s now illustrate all of this with a concrete example. Let’s get our
bearings first:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## On branch master</span>
<span class="c">## nothing to commit, working directory clean</span>
<span class="c">## total 8</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 47 Aug 13 09:44 file-newname.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  6 Aug 13 09:44 test.txt</span>
</pre></div>
</div>
<p>We are now going to try two different routes of development: on the
<em>master</em> branch we will add one file and on the <em>experiment</em> branch,
which we will create, we will add a different one. We will then merge
the experimental branch into <em>master</em>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Switched to branch &#39;experiment&#39;</span>
<span class="c">## [experiment c865f74] Trying something new</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
<span class="c">##  create mode 100644 experiment.txt</span>
<span class="c">## total 12</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 16 Aug 13 09:44 experiment.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 47 Aug 13 09:44 file-newname.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  6 Aug 13 09:44 test.txt</span>
<span class="c">## * c865f74 Trying something new</span>
<span class="c">## * 0cdbf65 added test file</span>
<span class="c">## * 6040d62 removed test file</span>
<span class="c">## * 9226ad5 added test file</span>
<span class="c">## * ef36523 I like this new name better</span>
<span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
</pre></div>
</div>
<p>We can see the branches, and which branch we are currently in
with`` git branch``. We’ll switch to the master and notice that
<em>experiment.txt</em> is not in the master branch.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## * experiment</span>
<span class="c">##   master</span>
<span class="c">## Switched to branch &#39;master&#39;</span>
<span class="c">## total 8</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 47 Aug 13 09:44 file-newname.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  6 Aug 13 09:44 test.txt</span>
</pre></div>
</div>
<p>Now, let’s make a different change to the master branch.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master 8a9040f] The mainline keeps moving</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
<span class="c">##  create mode 100644 progress.txt</span>
<span class="c">## * 8a9040f The mainline keeps moving</span>
<span class="c">## * 0cdbf65 added test file</span>
<span class="c">## * 6040d62 removed test file</span>
<span class="c">## * 9226ad5 added test file</span>
<span class="c">## * ef36523 I like this new name better</span>
<span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
</pre></div>
</div>
<p>Now we’ll merge the two together. Git can do this without guidance from
us because the differences in the two branches do not conflict with each
other.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Already on &#39;master&#39;</span>
<span class="c">## Merge made by the &#39;recursive&#39; strategy.</span>
<span class="c">##  experiment.txt | 1 +</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
<span class="c">##  create mode 100644 experiment.txt</span>
<span class="c">## *   a4b78e8 Merge branch &#39;experiment&#39;</span>
<span class="c">## |\</span>
<span class="c">## | * c865f74 Trying something new</span>
<span class="c">## * | 8a9040f The mainline keeps moving</span>
<span class="c">## |/</span>
<span class="c">## * 0cdbf65 added test file</span>
<span class="c">## * 6040d62 removed test file</span>
<span class="c">## * 9226ad5 added test file</span>
<span class="c">## * ef36523 I like this new name better</span>
<span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
<span class="c">## total 16</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 16 Aug 13 09:44 experiment.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 47 Aug 13 09:44 file-newname.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 46 Aug 13 09:44 progress.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  6 Aug 13 09:44 test.txt</span>
</pre></div>
</div>
<p>We are now going to introduce the concept of a remote repositor<em>y</em>: a
pointer to another copy of the repository that lives on a different
location. This can be simply a different path on the filesystem or a
server on the internet. Of course we’ve already used a remote repository
a little by cloning the class repository from Github.</p>
<p>For this discussion, we’ll be using remotes hosted on the Github.com
service, but you can equally use other services like BitBucket
(<a class="reference external" href="http://bitbucket.org">http://bitbucket.org</a>) or Gitorious (<a class="reference external" href="http://gitorious.org">http://gitorious.org</a>). The SCF
provides <a class="reference external" href="http://statistics.berkeley.edu/computing/git">hosting of git repositories as
well</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Since the <code class="docutils literal"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">-v</span></code> call didn’t produce any results, it means we
have no remote repositories configured. We will now proceed to do so. We
need a Github account. Login to GitHub, and go to the new repository
page (<a class="reference external" href="https://github.com/new">https://github.com/new</a>). For our demo purposes, we’ll make a
repository called <em>test</em>. Do <strong>not</strong> check the box that says
`Initialize this repository with a README`, since we already have an
existing repository on our local machine. That option is useful when
you’re starting first at Github and don’t have a repo made already on a
local computer.</p>
<p>We can now follow the instructions from the next page:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## To git@github.com:berkeley-stat243/test.git</span>
<span class="c">##  ! [rejected]        master -&gt; master (fetch first)</span>
<span class="c">## error: failed to push some refs to &#39;git@github.com:berkeley-stat243/test.git&#39;</span>
<span class="c">## hint: Updates were rejected because the remote contains work that you do</span>
<span class="c">## hint: not have locally. This is usually caused by another repository pushing</span>
<span class="c">## hint: to the same ref. You may want to first integrate the remote changes</span>
<span class="c">## hint: (e.g., &#39;git pull ...&#39;) before pushing again.</span>
<span class="c">## hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.</span>
<span class="c">## origin   git@github.com:berkeley-stat243/test.git (fetch)</span>
<span class="c">## origin   git@github.com:berkeley-stat243/test.git (push)</span>
</pre></div>
</div>
<p>We can now <a class="reference external" href="https://github.com/paciorek/test">see the repository
publicly</a>.</p>
<p>Let’s see how this can be useful for backup and syncing work between two
different computers.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Cloning into &#39;test2&#39;...</span>
<span class="c">## total 16</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 16 Aug 13 09:44 experiment.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 47 Aug 13 09:44 file-newname.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod 46 Aug 13 09:44 progress.txt</span>
<span class="c">## -rw-rw-r--. 1 jarrod jarrod  6 Aug 13 09:44 test.txt</span>
<span class="c">## origin   git@github.com:berkeley-stat243/test.git (fetch)</span>
<span class="c">## origin   git@github.com:berkeley-stat243/test.git (push)</span>
</pre></div>
</div>
<p>Let’s now make some changes in one computer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master 185c24e] More work, on machine #2</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
</pre></div>
</div>
<p>Now we put this new work up on the github server so it’s available from
the internet</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## To git@github.com:berkeley-stat243/test.git</span>
<span class="c">##    e0c1389..185c24e  master -&gt; master</span>
</pre></div>
</div>
<p>Now let’s fetch that work from machine #1:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## warning: no common commits</span>
<span class="c">## From github.com:berkeley-stat243/test</span>
<span class="c">##  * [new branch]      master     -&gt; origin/master</span>
<span class="c">## There is no tracking information for the current branch.</span>
<span class="c">## Please specify which branch you want to merge with.</span>
<span class="c">## See git-pull(1) for details</span>
<span class="c">##</span>
<span class="c">##     git pull &lt;remote&gt; &lt;branch&gt;</span>
<span class="c">##</span>
<span class="c">## If you wish to set tracking information for this branch you can do so with:</span>
<span class="c">##</span>
<span class="c">##     git branch --set-upstream-to=origin/&lt;branch&gt; master</span>
<span class="c">##</span>
<span class="c">## Some crazy idea</span>
</pre></div>
</div>
<p>While git is very good at merging, if two different users or two
different branches modify the same file in the same location, it simply
can’t decide which change should prevail. At that point, human
intervention is necessary to make the decision. Git will help you by
marking the location in the file that has a problem, but it’s up to you
to resolve the conflict. Let’s see how that works by intentionally
creating a conflict.</p>
<p>We start by creating a branch and making a change to our experiment
file:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Switched to branch &#39;trouble&#39;</span>
<span class="c">## [trouble c269eea] Changes in the trouble branch</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
</pre></div>
</div>
<p>And now we go back to the master branch, where we change the <strong>same</strong>
file:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Switched to branch &#39;master&#39;</span>
<span class="c">## [master a3ead37] Mainline work</span>
<span class="c">##  1 file changed, 1 insertion(+)</span>
</pre></div>
</div>
<p>So now let’s see what happens if we try to merge the `trouble` branch
into `master`:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Auto-merging experiment.txt</span>
<span class="c">## CONFLICT (content): Merge conflict in experiment.txt</span>
<span class="c">## Automatic merge failed; fix conflicts and then commit the result.</span>
</pre></div>
</div>
<p>Let’s see what git has put into our file:</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Some crazy idea</span>
<span class="c">## &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span>
<span class="c">## More work on the master branch...</span>
<span class="c">## =======</span>
<span class="c">## This is going to be a problem...</span>
<span class="c">## &gt;&gt;&gt;&gt;&gt;&gt;&gt; trouble</span>
</pre></div>
</div>
<p>At this point, we go into the file with a text editor, decide which
changes to keep, and make a new commit that records our decision. To
automate my edits, I use the `sed` command.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Some crazy idea</span>
<span class="c">## More work on the master branch...</span>
<span class="c">## This is going to be a problem...</span>
</pre></div>
</div>
<p>I’ve now made the edits, in this case I decided that both pieces of text
were useful, so I just accepted both additions.</p>
<p>Let’s then make our new commit:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## [master d9f99c4] Completed merge of trouble, fixing conflicts along the way</span>
<span class="c">## *   d9f99c4 Completed merge of trouble, fixing conflicts along the way</span>
<span class="c">## |\</span>
<span class="c">## | * c269eea Changes in the trouble branch</span>
<span class="c">## * | a3ead37 Mainline work</span>
<span class="c">## |/</span>
<span class="c">## *   a4b78e8 Merge branch &#39;experiment&#39;</span>
<span class="c">## |\</span>
<span class="c">## | * c865f74 Trying something new</span>
<span class="c">## * | 8a9040f The mainline keeps moving</span>
<span class="c">## |/</span>
<span class="c">## * 0cdbf65 added test file</span>
<span class="c">## * 6040d62 removed test file</span>
<span class="c">## * 9226ad5 added test file</span>
<span class="c">## * ef36523 I like this new name better</span>
<span class="c">## * 27fb906 I have made great progress on this critical matter.</span>
<span class="c">## * 47c1412 This is our first commit</span>
</pre></div>
</div>
<p>Note: While it’s a good idea to understand the basics of fixing merge
conflicts by hand, in some cases you may find the use of an automated
tool useful. Git supports multiple <a class="reference external" href="https://www.kernel.org/pub/software/scm/git/docs/git-mergetool.html">merge
tools</a>:
a merge tool is a piece of software that conforms to a basic interface
and knows how to merge two files into a new one. Since these are
typically graphical tools, there are various to choose from for the
different operating systems, and as long as they obey a basic command
structure, git can work with any of them.</p>
<p>Single remote with shared access: we are going to set up a shared
collaboration with one partner (the person sitting next to you). This
will show the basic workflow of collaborating on a project with a small
team where everyone has write privileges to the same repository.</p>
<p>We will have two people, let’s call them Alice and Bob, sharing a
repository. Alice will be the owner of the repo and she will give Bob
write privileges.</p>
<p>We begin with a simple synchronization example, much like we just did
above, but now between two people instead of one person. Otherwise it’s
the same:</p>
<ul class="simple">
<li>Bob clones Alice’s repository.</li>
<li>Bob makes changes to a file and commits them locally.</li>
<li>Bob pushes his changes to github.</li>
<li>Alice pulls Bob’s changes into her own repository.</li>
</ul>
<p>Next, we will have both parties make non-conflicting changes each, and
commit them locally. Then both try to push their changes:</p>
<ul class="simple">
<li>Alice adds a new file, <em>alice.txt</em> to the repo and commits.</li>
<li>Bob adds <em>bob.txt</em> and commits.</li>
<li>Alice pushes to github.</li>
<li>Bob tries to push to github.</li>
</ul>
<p>What happens here?</p>
<p>The problem is that Bob’s changes create a commit that conflicts with
Alice’s, so git refuses to apply them. It forces Bob to first do the
merge on his machine, so that if there is a conflict in the merge, Bob
deals with the conflict manually (git could try to do the merge on the
server, but in that case if there’s a conflict, the server repo would be
left in a conflicted state without a human to fix things up). The
solution is for Bob to first pull the changes (pull in git is really
fetch+merge), and then push again.</p>
<ul>
<li><p class="first">Git for Scientists: A Tutorial: <a class="reference external" href="http://nyuccl.org/pages/GitTutorial/">http://nyuccl.org/pages/GitTutorial/</a></p>
</li>
<li><div class="first line-block">
<div class="line">Gitwash: workflow for scientific Python projects:</div>
<div class="line"><a class="reference external" href="http://matthew-brett.github.io/pydagogue/gitwash_build.html">http://matthew-brett.github.io/pydagogue/gitwash_build.html</a></div>
</div>
</li>
<li><p class="first">Git branching demo: <a class="reference external" href="http://pcottle.github.io/learnGitBranching/">http://pcottle.github.io/learnGitBranching/</a></p>
</li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RCSDS</a></h1>



<p class="blurb">Fall 2015</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standard/index.html">Core Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="append/index.html">Appendices</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://www.jarrodmillman.com/stat159-fall2015/">Course home</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
      &copy;2009-2015, K. Jarrod Millman.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/index.txt"
          rel="nofollow">Page source</a>
        <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
    </div>

  </body>
</html>